<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Aurora</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aurora: {
                            bg: '#020617',     
                            card: 'rgba(30, 41, 59, 0.4)', 
                            border: 'rgba(148, 163, 184, 0.15)',
                            primary: '#22d3ee', 
                            secondary: '#a855f7', 
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    animation: {
                        'aurora-flow': 'aurora 15s ease infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                        'shine': 'shine 1.5s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        aurora: {
                            '0%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                            '100%': { backgroundPosition: '0% 50%' }
                        },
                        float: { 
                            '0%, 100%': { transform: 'translateY(0)' }, 
                            '50%': { transform: 'translateY(-10px)' } 
                        },
                        shine: { '0%': { transform: 'translateX(-100%)' }, '100%': { transform: 'translateX(100%)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/@babel/standalone@7.26.9/babel.min.js"></script>

    <style>
        body { 
            background-color: #020617; 
            color: #f1f5f9;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            min-height: 100dvh; 
        }
        
        /* Animated Background */
        .aurora-bg {
            background: linear-gradient(-45deg, #020617, #1e1b4b, #111827, #0f172a);
            background-size: 400% 400%;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            animation: aurora 15s ease infinite alternate;
        }

        .aurora-glow {
            position: fixed;
            width: 80vw;
            height: 80vw;
            background: radial-gradient(circle, rgba(34,211,238,0.1) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
            top: -20%;
            left: -20%;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.3);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Safe Area Padding for Notch */
        .safe-area-top {
            padding-top: 80px;
        }
    </style>
</head>
<body>
    <div class="aurora-bg"></div>
    <div class="aurora-glow"></div>
    
    <div id="root" class="min-h-[100dvh]"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Trophy, Diamond, Zap, Camera, CheckCircle, Activity, User, Settings, Plus, X, 
            Hexagon, Flame, Send, Bell, Skull, Dumbbell, Ruler, 
            BarChart3, Users, Calendar, ChevronUp, ChevronDown, Siren, Shield, Edit3, Save, CalendarDays
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- CONFIGURATION ---
        // –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –°–°–´–õ–ö–£ –ò–ó GOOGLE APPS SCRIPT
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/library/d/1zIhoIYV8JDFhRzaiAqIVwDanbakHeJprh8xY5IB9MtfocMqm9gd545VT/4'; 
        
        const ADMIN_USERNAME = 'solomin_d'; // –ú–∞—Å—Ç–µ—Ä –∞–∫–∫–∞—É–Ω—Ç
        const DEFAULT_START_DATE = new Date('2026-04-01'); // –§–æ–ª–±—ç–∫ –¥–∞—Ç–∞

        // --- UI COMPONENTS ---

        const GlassCard = ({ children, className = "", onClick }) => (
            <div onClick={onClick} className={`relative glass-panel rounded-2xl overflow-hidden ${onClick ? 'cursor-pointer active:scale-95 transition-transform' : ''} ${className}`}>
                <div className="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
                {children}
            </div>
        );

        const NeonButton = ({ children, onClick, variant = 'primary', disabled = false, className = "" }) => {
            const variants = {
                primary: "bg-cyan-600/80 text-white border-cyan-400/30 shadow-[0_0_15px_rgba(34,211,238,0.3)]",
                danger: "bg-rose-600/80 text-white border-rose-400/30 shadow-[0_0_15px_rgba(225,29,72,0.3)]",
                gold: "bg-amber-500/80 text-white border-amber-300/30 shadow-[0_0_15px_rgba(245,158,11,0.3)]",
                disabled: "bg-slate-800/50 text-slate-500 border-slate-700 cursor-not-allowed"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`w-full py-4 font-bold tracking-wider uppercase rounded-xl border backdrop-blur-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${disabled ? variants.disabled : variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const Avatar = ({ name, photoUrl, className = "", size = "w-10 h-10" }) => {
            if (photoUrl) {
                return <img src={photoUrl} alt={name} className={`${size} rounded-full object-cover border border-white/20 shadow-lg ${className}`} />;
            }
            const initials = name ? name.slice(0, 2).toUpperCase() : "FQ";
            const gradients = ["from-cyan-500 to-blue-600", "from-purple-500 to-indigo-600", "from-emerald-400 to-teal-600"];
            return (
                <div className={`${size} rounded-full bg-gradient-to-br ${gradients[name ? name.length % 3 : 0]} flex items-center justify-center text-white font-bold shadow-lg border border-white/20 ${className}`}>
                    {initials}
                </div>
            );
        };

        // --- APP ---

        function App() {
            // State
            const [step, setStep] = useState('loading');
            const [user, setUser] = useState({
                firstName: '', lastName: '', username: '', telegramId: null, photoUrl: null,
                disciplines: [], goal: 0, diamonds: 3, streak: 0,
                todayActivity: [], history: [], status: 'active', notifications: true, isAdmin: false
            });
            
            // –î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Ç–∞–±–ª–∏—Ü–µ–π)
            const [marathonStartDate, setMarathonStartDate] = useState(DEFAULT_START_DATE);
            const [isSyncing, setIsSyncing] = useState(false);

            // Flow & UI State
            const [regForm, setRegForm] = useState({ firstName: '', lastName: '' });
            const [popularSports, setPopularSports] = useState(['–ë–µ–≥', '–ó–∞–ª', '–û—Ç–∂–∏–º–∞–Ω–∏—è', '–ü–ª–∞–≤–∞–Ω–∏–µ', '–í–æ—Ä–∫–∞—É—Ç', '–í–µ–ª–æ']);
            const [dashboardView, setDashboardView] = useState('leaderboard'); // 'leaderboard' | 'progress' | 'admin' | 'shop'
            
            // Modals
            const [checkInModalOpen, setCheckInModalOpen] = useState(false);
            const [checkInStage, setCheckInStage] = useState('select');
            const [selectedSportForCheckIn, setSelectedSportForCheckIn] = useState(null);
            const [checkInValue, setCheckInValue] = useState("");
            const [editingProfile, setEditingProfile] = useState(false);
            const [adminPanelOpen, setAdminPanelOpen] = useState(false);
            const [selectedUserForDetail, setSelectedUserForDetail] = useState(null);
            const [adminDateInput, setAdminDateInput] = useState('');

            // Data
            const [leaderboard, setLeaderboard] = useState([
                { id: 1, name: 'Alex', photoUrl: null, diamonds: 3, streak: 12, goal: 100, status: 'active', disciplines: ['–ë–µ–≥', '–í–æ—Ä–∫–∞—É—Ç'], history: [], badges: ['streak', 'runner'] },
                { id: 2, name: 'Elena', photoUrl: null, diamonds: 5, streak: 45, goal: 60, status: 'active', disciplines: ['–ó–∞–ª', '–ü–ª–∞–≤–∞–Ω–∏–µ'], history: [], badges: ['gym'] },
                { id: 3, name: 'Max', photoUrl: null, diamonds: 0, streak: 8, goal: 30, status: 'frozen', disciplines: ['–ë–æ–∫—Å'], history: [], badges: [] },
            ]);

            // --- INITIALIZATION ---
            useEffect(() => {
                const init = async () => {
                    // Telegram Init
                    const tg = window.Telegram?.WebApp;
                    if (tg) {
                        tg.ready();
                        tg.expand(); // Force Full Screen
                        tg.setHeaderColor('#020617');
                        tg.setBackgroundColor('#020617');
                    }

                    // Fetch Date from Google Sheet
                    if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.startsWith('http')) {
                        try {
                            const res = await fetch(GOOGLE_SCRIPT_URL);
                            const data = await res.json();
                            if (data.result === 'success' && data.config?.MARATHON_START_DATE) {
                                const fetchedDate = new Date(data.config.MARATHON_START_DATE);
                                setMarathonStartDate(fetchedDate);
                                setAdminDateInput(data.config.MARATHON_START_DATE);
                                console.log("Date synced:", fetchedDate);
                            }
                        } catch (e) {
                            console.error("Sync failed, using default date", e);
                        }
                    }

                    // Load User
                    const savedUser = localStorage.getItem('fitness_aurora_user');
                    const tgUser = tg?.initDataUnsafe?.user;
                    
                    if (savedUser) {
                        const parsed = JSON.parse(savedUser);
                        // Update photo and admin status from TG
                        if (tgUser) {
                            parsed.photoUrl = tgUser.photo_url;
                            parsed.isAdmin = (tgUser.username === ADMIN_USERNAME);
                        }
                        setUser(parsed);
                        setStep('dashboard');
                    } else {
                        if (tgUser) {
                            setRegForm({ firstName: tgUser.first_name || '', lastName: tgUser.last_name || '' });
                            setUser(prev => ({ 
                                ...prev, 
                                telegramId: tgUser.id, 
                                username: tgUser.username, 
                                photoUrl: tgUser.photo_url,
                                isAdmin: tgUser.username === ADMIN_USERNAME 
                            }));
                        }
                        setStep('welcome');
                    }
                };
                init();
            }, []);

            useEffect(() => { 
                if (user.firstName) localStorage.setItem('fitness_aurora_user', JSON.stringify(user)); 
            }, [user]);

            // --- LOGIC: DYNAMIC GOALS ---
            const getAdjustedGoals = () => {
                const now = new Date();
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø—Ä–æ—à–ª–æ —Å –Ω–∞—á–∞–ª–∞ –º–∞—Ä–∞—Ñ–æ–Ω–∞
                // –ï—Å–ª–∏ —Å—Ç–∞—Ä—Ç –≤ –±—É–¥—É—â–µ–º, diffDays –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
                const diffTime = now - marathonStartDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                // –ï—Å–ª–∏ –º–∞—Ä–∞—Ñ–æ–Ω –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª—Å—è (diffDays <= 0), —Ü–µ–ª–∏ –ø–æ–ª–Ω—ã–µ.
                // –ï—Å–ª–∏ –Ω–∞—á–∞–ª—Å—è, –≤—ã—á–∏—Ç–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ –¥–Ω–∏ –∏–∑ —Ü–µ–ª–∏.
                // –ü—Ä–∏–º–µ—Ä: –°—Ç–∞—Ä—Ç 1 —è–Ω–≤. –°–µ–π—á–∞—Å 5 —è–Ω–≤ (–ø—Ä–æ—à–ª–æ 4 –¥–Ω—è). –¶–µ–ª—å 30 -> –æ—Å—Ç–∞–ª–æ—Å—å 26.
                const daysPassed = diffDays > 0 ? diffDays : 0;

                const baseGoals = [30, 60, 100];
                
                return baseGoals.map(g => {
                    const remaining = g - daysPassed;
                    return {
                        original: g,
                        remaining: remaining,
                        label: g === 30 ? '–ù–æ–≤–∏—á–æ–∫' : g === 60 ? '–ê—Ç–ª–µ—Ç' : '–ö–∏–±–æ—Ä–≥'
                    };
                }).filter(g => g.remaining > 5); // –°–∫—Ä—ã–≤–∞–µ–º —Ü–µ–ª–∏, –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ 5 –¥–Ω–µ–π
            };

            // --- ADMIN ACTIONS ---
            const handleUpdateDate = async () => {
                if (!adminDateInput) return;
                setIsSyncing(true);
                try {
                    // Optimistic update
                    setMarathonStartDate(new Date(adminDateInput));
                    
                    if (GOOGLE_SCRIPT_URL) {
                        // Send to Google Sheet (using no-cors workaround for GAS simple triggers if needed, but fetch usually works for WebApp)
                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            body: JSON.stringify({ action: 'UPDATE_DATE', date: adminDateInput })
                        });
                    }
                    setAdminPanelOpen(false);
                    alert("–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!");
                } catch (e) {
                    alert("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: " + e.message);
                } finally {
                    setIsSyncing(false);
                }
            };

            // --- HANDLERS ---
            const handleRegNext = () => { if (regForm.firstName) { setUser(p => ({ ...p, firstName: regForm.firstName, lastName: regForm.lastName })); setStep('arsenal'); } };
            const handleArsenalToggle = (sport) => setUser(prev => { const exists = prev.disciplines.includes(sport); if (exists) return { ...prev, disciplines: prev.disciplines.filter(d => d !== sport) }; if (prev.disciplines.length >= 5) return prev; return { ...prev, disciplines: [...prev.disciplines, sport] }; });
            const handleGoalSelect = (goal) => { setUser(prev => ({ ...prev, goal })); setStep('dashboard'); };
            
            const handleCheckInComplete = (val, unit) => {
                const sport = selectedSportForCheckIn;
                setUser(prev => ({
                    ...prev,
                    streak: prev.todayActivity.length === 0 ? prev.streak + 1 : prev.streak,
                    todayActivity: [...prev.todayActivity, sport],
                    history: [{ date: new Date().toISOString(), sport, value: val, unit }, ...prev.history]
                }));
                setCheckInModalOpen(false);
                setCheckInStage('select');
            };

            const sendMotivation = (e, userName) => {
                e.stopPropagation(); // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –º–æ–ª–Ω–∏—é
                alert(`–ú–æ—Ç–∏–≤–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ${userName}! ‚ö°Ô∏è`);
            };

            // --- VIEWS COMPONENTS ---

            const AdminPanelModal = () => (
                <div className="fixed inset-0 z-50 bg-[#020617] p-6 pt-safe-top overflow-y-auto animate-fade-in">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl font-display font-bold text-amber-500 tracking-wider flex items-center gap-2"><Shield /> MASTER ADMIN</h2>
                        <button onClick={() => setAdminPanelOpen(false)} className="p-2 bg-white/10 rounded-full text-white"><X size={20}/></button>
                    </div>
                    
                    <div className="space-y-6">
                        <GlassCard className="p-6">
                            <h3 className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-4">–î–∞—Ç–∞ –°—Ç–∞—Ä—Ç–∞ –ú–∞—Ä–∞—Ñ–æ–Ω–∞</h3>
                            <div className="flex gap-2">
                                <input 
                                    type="date" 
                                    value={adminDateInput}
                                    onChange={(e) => setAdminDateInput(e.target.value)}
                                    className="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-cyan-500"
                                />
                            </div>
                            <p className="text-[10px] text-slate-500 mt-2">–¢–µ–∫—É—â–∞—è: {marathonStartDate.toLocaleDateString()}</p>
                            <p className="text-[10px] text-emerald-500 mt-1">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å Google –¢–∞–±–ª–∏—Ü–µ–π (–Ø—á–µ–π–∫–∞ B2)</p>
                        </GlassCard>

                        <NeonButton variant="gold" onClick={handleUpdateDate} disabled={isSyncing}>
                            {isSyncing ? "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è..." : "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –î–∞—Ç—É"} <Save size={18} />
                        </NeonButton>

                        <div className="pt-4 border-t border-white/10">
                            <h3 className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –£—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏</h3>
                            {leaderboard.map(u => (
                                <div key={u.id} className="flex justify-between items-center py-2 border-b border-white/5 last:border-0">
                                    <span className="text-white font-bold">{u.name}</span>
                                    <button className="text-xs text-rose-400 border border-rose-400/30 px-2 py-1 rounded">Kick</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const UserDetailModal = ({ detailUser, onClose }) => {
                if (!detailUser) return null;
                const stats = detailUser.history?.length || 0; // Mock stat logic
                return (
                    <div className="fixed inset-0 z-40 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in">
                        <div className="w-full max-w-sm bg-[#0f172a] border border-white/10 rounded-3xl p-6 relative">
                            <button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={24}/></button>
                            <div className="flex flex-col items-center mb-6">
                                <Avatar name={detailUser.name} photoUrl={detailUser.photoUrl} size="w-20 h-20" className="mb-4" />
                                <h3 className="text-2xl font-display font-bold text-white">{detailUser.name}</h3>
                                <span className={`text-xs uppercase font-bold px-2 py-1 rounded mt-2 ${detailUser.status === 'active' ? 'bg-emerald-500/10 text-emerald-400' : 'bg-rose-500/10 text-rose-400'}`}>{detailUser.status}</span>
                            </div>
                            <div className="grid grid-cols-2 gap-3 mb-6">
                                <div className="bg-white/5 p-3 rounded-xl text-center"><Flame className="mx-auto text-orange-400 mb-1" size={16}/><div className="font-bold text-white">{detailUser.streak}</div><div className="text-[9px] text-slate-400 uppercase">–°—Ç—Ä–∏–∫</div></div>
                                <div className="bg-white/5 p-3 rounded-xl text-center"><Diamond className="mx-auto text-cyan-400 mb-1" size={16}/><div className="font-bold text-white">{detailUser.diamonds}</div><div className="text-[9px] text-slate-400 uppercase">–ê–ª–º–∞–∑—ã</div></div>
                            </div>
                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">–î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</h4>
                            <div className="flex flex-wrap gap-2 mb-6">
                                {detailUser.disciplines.map(d => <span key={d} className="px-2 py-1 bg-white/5 rounded text-xs text-slate-300">{d}</span>)}
                            </div>
                            <NeonButton variant="secondary" onClick={onClose}>–ó–∞–∫—Ä—ã—Ç—å –¥–µ–ª–æ</NeonButton>
                        </div>
                    </div>
                );
            };

            const RedemptionShop = () => (
                <div className="fixed inset-0 z-30 bg-[#020617] pt-safe-top overflow-y-auto animate-slide-up">
                    <div className="p-6">
                        <div className="flex items-center gap-3 mb-8">
                            <button onClick={() => setDashboardView('leaderboard')} className="p-2 bg-white/10 rounded-full text-white"><X size={20}/></button>
                            <h2 className="text-2xl font-display font-bold text-rose-500 tracking-wider">–ú–ê–ì–ê–ó–ò–ù –ò–°–ö–£–ü–õ–ï–ù–ò–Ø</h2>
                        </div>
                        <div className="relative rounded-2xl overflow-hidden mb-8 border border-rose-500/30 bg-rose-900/10 p-8 text-center">
                            <div className="inline-flex items-center justify-center w-16 h-16 bg-rose-500/20 rounded-full mb-4 animate-pulse"><Skull className="text-rose-500" size={32} /></div>
                            <h3 className="text-xl font-bold text-white uppercase mb-2">–ö–£–ü–ò–¢–¨ –ñ–ò–ó–ù–¨</h3>
                            <p className="text-rose-400 text-xs mb-6">–¶–µ–Ω–∞: –¢–≤–æ—è –≥–æ—Ä–¥–æ—Å—Ç—å (—Ñ–æ—Ç–æ)</p>
                            <NeonButton variant="danger">–ö–†–£–¢–ò–¢–¨ –†–£–õ–ï–¢–ö–£ –ó–ê–î–ê–ù–ò–ô</NeonButton>
                        </div>
                    </div>
                </div>
            );

            // --- RENDER STEPS ---

            if (step === 'welcome') return (
                <div className="flex flex-col h-full min-h-[100dvh] p-6 pt-safe-top relative z-10">
                    <div className="flex-grow flex flex-col items-center justify-center text-center">
                         <div className="relative w-40 h-40 flex items-center justify-center mb-8">
                            <div className="absolute inset-0 bg-cyan-500 blur-[60px] opacity-30 rounded-full animate-pulse"></div>
                            <Hexagon size={130} className="text-cyan-400 stroke-[1.5] animate-float" />
                            <Activity size={50} className="text-white absolute" />
                        </div>
                        <h1 className="text-4xl font-black text-white font-display uppercase">Fitness<br/>Aurora</h1>
                        <p className="text-cyan-200/80 text-xs mt-4 uppercase tracking-widest">–¢–≤–æ—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —Å–ø–æ—Ä—Ç–∞</p>
                    </div>
                    <NeonButton onClick={() => setStep('registration')}>–ù–∞—á–∞—Ç—å</NeonButton>
                </div>
            );

            if (step === 'registration') return (
                <div className="flex flex-col h-full min-h-[100dvh] p-6 pt-safe-top relative z-10 animate-slide-up">
                    <h2 className="text-2xl font-display font-bold text-white mb-6">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø</h2>
                    <div className="space-y-4 flex-grow">
                        <input type="text" value={regForm.firstName} onChange={e => setRegForm({...regForm, firstName: e.target.value})} className="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:border-cyan-500" placeholder="–ò–º—è" />
                        <input type="text" value={regForm.lastName} onChange={e => setRegForm({...regForm, lastName: e.target.value})} className="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:border-cyan-500" placeholder="–§–∞–º–∏–ª–∏—è" />
                    </div>
                    <NeonButton onClick={handleRegNext} disabled={!regForm.firstName}>–î–∞–ª–µ–µ</NeonButton>
                </div>
            );

            if (step === 'arsenal') return (
                <div className="flex flex-col h-full min-h-[100dvh] p-6 pt-safe-top relative z-10 animate-slide-up">
                    <h2 className="text-2xl font-display font-bold text-white mb-2">–ê–†–°–ï–ù–ê–õ</h2>
                    <p className="text-slate-400 text-xs mb-6">–í—ã–±–µ—Ä–∏ –¥–æ 5 –¥–∏—Å—Ü–∏–ø–ª–∏–Ω</p>
                    <div className="flex flex-wrap gap-3 mb-6">
                        {popularSports.map(s => (
                            <button key={s} onClick={() => handleArsenalToggle(s)} className={`px-4 py-3 rounded-xl text-sm font-bold border transition-all ${user.disciplines.includes(s) ? 'bg-cyan-600/80 text-white border-cyan-400' : 'bg-white/5 text-slate-400 border-white/10'}`}>{s}</button>
                        ))}
                    </div>
                    <div className="mt-auto">
                        <NeonButton onClick={() => setStep('goal')} disabled={user.disciplines.length === 0}>–î–∞–ª–µ–µ</NeonButton>
                    </div>
                </div>
            );

            if (step === 'goal') {
                const goals = getAdjustedGoals();
                return (
                    <div className="flex flex-col h-full min-h-[100dvh] p-6 pt-safe-top relative z-10 animate-slide-up">
                        <h2 className="text-2xl font-display font-bold text-white mb-6 text-center">–í–´–ë–ï–†–ò –¶–ï–õ–¨</h2>
                        <div className="space-y-4 flex-grow">
                            {goals.length > 0 ? goals.map((g, idx) => (
                                <GlassCard key={idx} onClick={() => handleGoalSelect(g.remaining)} className="p-6 flex items-center justify-between group hover:bg-white/10 transition-colors">
                                    <div>
                                        <span className="text-3xl font-display font-black text-white">{g.remaining} <span className="text-sm font-sans font-normal text-slate-400">–î–Ω–µ–π</span></span>
                                        <div className="text-[10px] text-cyan-400 font-bold uppercase mt-1">–†–∞–Ω–≥: {g.label}</div>
                                    </div>
                                    <div className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white"><Trophy size={20}/></div>
                                </GlassCard>
                            )) : (
                                <div className="text-center text-slate-400 p-8 border border-white/10 rounded-xl">
                                    –ú–∞—Ä–∞—Ñ–æ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω –∏–ª–∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –∫–æ–Ω—Ü—É.
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // --- DASHBOARD ---
            const progressPercent = Math.min((user.streak / (user.goal || 1)) * 100, 100);

            return (
                <div className="pb-24 relative min-h-[100dvh] pt-safe-top">
                    
                    {/* Header */}
                    <div className="sticky top-0 bg-[#020617]/90 backdrop-blur-xl z-20 px-6 py-4 border-b border-white/5">
                        <div className="flex justify-between items-start mb-4">
                            <div className="flex items-center gap-3">
                                <Avatar name={user.firstName} photoUrl={user.photoUrl} />
                                <div>
                                    <div className="font-display font-bold text-white leading-tight">{user.firstName}</div>
                                    <div className="text-[10px] text-slate-400 font-bold uppercase mt-0.5">
                                        –°—Ç–∞—Ç—É—Å: <span className="text-emerald-400">–í —Å—Ç—Ä–æ—é</span>
                                    </div>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                {/* Admin Button */}
                                {user.isAdmin && (
                                    <button onClick={() => setAdminPanelOpen(true)} className="w-10 h-10 flex items-center justify-center rounded-lg bg-amber-500/20 text-amber-500 border border-amber-500/30">
                                        <Shield size={18} />
                                    </button>
                                )}
                                <div className="bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 flex items-center gap-2">
                                    <Diamond size={16} className="text-cyan-400 fill-cyan-400" />
                                    <span className="font-bold text-white">{user.diamonds}</span>
                                </div>
                            </div>
                        </div>
                        {/* Progress Bar */}
                        <div className="flex justify-between text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-widest">
                            <span>{user.streak} Days</span>
                            <span>Goal: {user.goal}</span>
                        </div>
                        <div className="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden relative">
                            <div className="bg-gradient-to-r from-cyan-500 to-purple-500 h-full shadow-[0_0_10px_rgba(34,211,238,0.5)]" style={{ width: `${progressPercent}%` }}></div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="p-6 space-y-6">
                        {/* Check-in Button */}
                        <button onClick={() => setCheckInModalOpen(true)} className="w-full aspect-[2.5/1] rounded-2xl glass-panel relative group overflow-hidden active:scale-[0.98] transition-all">
                            <div className="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-purple-500/10 opacity-50"></div>
                            <div className="relative z-10 flex flex-col items-center justify-center h-full gap-2">
                                <Zap size={28} className="text-cyan-400 fill-cyan-400 mb-1" />
                                <span className="text-xl font-display font-black text-white uppercase tracking-widest">–û–¢–ú–ï–¢–ò–¢–¨–°–Ø</span>
                            </div>
                        </button>

                        {/* Tabs */}
                        <div className="flex gap-4 border-b border-white/10 pb-2">
                            <button onClick={() => setDashboardView('leaderboard')} className={`text-xs font-bold uppercase tracking-widest pb-2 transition-colors ${dashboardView === 'leaderboard' ? 'text-cyan-400 border-b-2 border-cyan-400' : 'text-slate-500'}`}>–†–µ–π—Ç–∏–Ω–≥</button>
                            <button onClick={() => setDashboardView('shop')} className={`text-xs font-bold uppercase tracking-widest pb-2 transition-colors ${dashboardView === 'shop' ? 'text-rose-400 border-b-2 border-rose-400' : 'text-slate-500'}`}>–ú–∞–≥–∞–∑–∏–Ω</button>
                        </div>

                        {/* Leaderboard View */}
                        {dashboardView === 'leaderboard' && (
                            <div className="space-y-3">
                                {leaderboard.map((u, idx) => (
                                    <GlassCard key={u.id} onClick={() => setSelectedUserForDetail(u)} className="p-4 flex items-center justify-between hover:bg-white/5 transition-colors">
                                        <div className="flex items-center gap-4">
                                            <div className="relative">
                                                <Avatar name={u.name} photoUrl={u.photoUrl} />
                                                <div className="absolute -top-1 -right-1 bg-slate-900 rounded-full w-4 h-4 flex items-center justify-center text-[9px] font-bold border border-slate-700 text-white">{idx + 1}</div>
                                            </div>
                                            <div>
                                                <div className="font-bold text-slate-200">{u.name}</div>
                                                <div className="text-[10px] text-slate-500 uppercase">{u.disciplines.slice(0, 2).join(', ')}</div>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="text-right">
                                                <div className="font-bold text-white text-sm">{u.streak} <span className="text-[10px] text-orange-400">üî•</span></div>
                                            </div>
                                            {/* Motivation Button */}
                                            <button 
                                                onClick={(e) => sendMotivation(e, u.name)}
                                                className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-cyan-400 hover:bg-cyan-400 hover:text-white transition-colors"
                                            >
                                                <Zap size={14} />
                                            </button>
                                        </div>
                                    </GlassCard>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Modals & Overlays */}
                    {adminPanelOpen && <AdminPanelModal />}
                    {selectedUserForDetail && <UserDetailModal detailUser={selectedUserForDetail} onClose={() => setSelectedUserForDetail(null)} />}
                    {dashboardView === 'shop' && <RedemptionShop />}

                    {/* Check In Modal */}
                    {checkInModalOpen && (
                        <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-end sm:items-center justify-center p-4 animate-fade-in">
                            <div className="w-full max-w-md bg-[#0f172a] border border-white/10 rounded-t-3xl p-6 sm:rounded-3xl">
                                {checkInStage === 'select' ? (
                                    <>
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-lg font-bold text-white">–ß–¢–û –°–î–ï–õ–ê–ù–û?</h3>
                                            <button onClick={() => setCheckInModalOpen(false)}><X className="text-slate-500" /></button>
                                        </div>
                                        <div className="space-y-3">
                                            {user.disciplines.map(s => (
                                                <button key={s} onClick={() => { setSelectedSportForCheckIn(s); setCheckInStage('value'); }} className="w-full p-4 bg-white/5 rounded-xl text-left font-bold text-slate-300 hover:bg-cyan-500/10 hover:text-cyan-400 transition-colors flex justify-between">
                                                    {s} <ChevronDown size={16} className="-rotate-90 text-slate-600" />
                                                </button>
                                            ))}
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center">
                                        <h3 className="text-lg font-bold text-white mb-6">{selectedSportForCheckIn}</h3>
                                        <div className="flex items-end justify-center gap-2 mb-8">
                                            <input type="number" autoFocus onChange={e => setCheckInValue(e.target.value)} className="bg-transparent border-b-2 border-slate-700 text-center text-5xl font-black text-white w-32 outline-none focus:border-cyan-500" placeholder="0" />
                                            <span className="text-slate-500 font-bold mb-2">–ï–î.</span>
                                        </div>
                                        <div className="flex gap-3">
                                            <NeonButton variant="disabled" onClick={() => setCheckInStage('select')}>–ù–∞–∑–∞–¥</NeonButton>
                                            <NeonButton onClick={() => handleCheckInComplete(checkInValue, 'units')} disabled={!checkInValue}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</NeonButton>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
