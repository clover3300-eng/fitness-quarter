<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Aurora Ultimate</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { aurora: { bg: '#020617' } },
                    fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Space Grotesk', 'sans-serif'] },
                    animation: {
                        'aurora-flow': 'aurora 15s ease infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                        'shine': 'shine 1.5s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        aurora: { '0%': { backgroundPosition: '0% 50%' }, '100%': { backgroundPosition: '100% 50%' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        shine: { '0%': { transform: 'translateX(-100%)' }, '100%': { transform: 'translateX(100%)' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone@7.26.9/babel.min.js"></script>

    <style>
        html, body { margin: 0; padding: 0; background-color: #020617; color: #f1f5f9; width: 100%; height: 100%; overflow: hidden; overscroll-behavior: none; -webkit-tap-highlight-color: transparent; }
        .aurora-bg { background: linear-gradient(-45deg, #020617, #1e1b4b, #111827, #0f172a); background-size: 400% 400%; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: -1; animation: aurora 15s ease infinite alternate; }
        .aurora-glow { position: fixed; width: 80vw; height: 80vw; background: radial-gradient(circle, rgba(34,211,238,0.1) 0%, rgba(0,0,0,0) 70%); border-radius: 50%; pointer-events: none; z-index: -1; top: -20%; left: -20%; }
        .glass-panel { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .screen-content { padding-top: 140px; padding-left: 1.5rem; padding-right: 1.5rem; padding-bottom: 6rem; height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; height: 130px; padding-top: 10px; padding-left: 1.5rem; padding-right: 1.5rem; background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(20px); z-index: 40; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; justify-content: center; }
    </style>
</head>
<body>
    <div class="aurora-bg"></div><div class="aurora-glow"></div><div id="root" class="h-full"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { Trophy, Diamond, Zap, Camera, CheckCircle, Activity, User, Settings, Plus, X, Hexagon, Flame, Send, Bell, Skull, Dumbbell, Ruler, Star, Crown, BarChart3, Users, Calendar, ChevronUp, ChevronDown, Siren, Shield, Edit3, Save, Trash2, ArrowLeft, Clock, UserPlus, Sun, Moon } from 'https://esm.sh/lucide-react@0.263.1';

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/library/d/1zIhoIYV8JDFhRzaiAqIVwDanbakHeJprh8xY5IB9MtfocMqm9gd545VT/4'; 
        const ADMIN_USERNAME = 'solomin_d';
        const DEFAULT_START_DATE = new Date('2026-04-01');

        const GlassCard = ({ children, className = "", onClick }) => (<div onClick={onClick} className={`relative glass-panel rounded-2xl overflow-hidden ${onClick ? 'cursor-pointer active:scale-95 transition-transform' : ''} ${className}`}><div className="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>{children}</div>);
        const NeonButton = ({ children, onClick, variant = 'primary', disabled = false, className = "" }) => {
            const variants = { primary: "bg-cyan-600/80 text-white border-cyan-400/30 shadow-[0_0_15px_rgba(34,211,238,0.3)]", danger: "bg-rose-600/80 text-white border-rose-400/30 shadow-[0_0_15px_rgba(225,29,72,0.3)]", gold: "bg-amber-500/80 text-white border-amber-300/30 shadow-[0_0_15px_rgba(245,158,11,0.3)]", disabled: "bg-slate-800/50 text-slate-500 border-slate-700 cursor-not-allowed" };
            return (<button onClick={onClick} disabled={disabled} className={`w-full py-4 font-bold tracking-wider uppercase rounded-xl border backdrop-blur-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${disabled ? variants.disabled : variants[variant]} ${className}`}>{children}</button>);
        };
        const ToggleSwitch = ({ checked, onChange }) => (<button onClick={() => onChange(!checked)} className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 relative ${checked ? 'bg-cyan-500' : 'bg-slate-700/50 border border-slate-600'}`}><div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform duration-300 ${checked ? 'translate-x-6' : 'translate-x-0'}`} /></button>);
        const Avatar = ({ name, photoUrl, className = "", size = "w-10 h-10" }) => {
            if (photoUrl) return <img src={photoUrl} alt={name} className={`${size} rounded-full object-cover border border-white/20 shadow-lg ${className}`} />;
            const initials = name ? name.slice(0, 2).toUpperCase() : "FQ";
            const gradients = ["from-cyan-500 to-blue-600", "from-purple-500 to-indigo-600", "from-emerald-400 to-teal-600"];
            return <div className={`${size} rounded-full bg-gradient-to-br ${gradients[name ? name.length % 3 : 0]} flex items-center justify-center text-white font-bold shadow-lg border border-white/20 ${className}`}>{initials}</div>;
        };

        const badgesData = [
            { id: 'streak', icon: <Flame size={14} />, color: 'text-orange-400', bg: 'bg-orange-500/20', label: '–ù–∞ –æ–≥–Ω–µ' },
            { id: 'runner', icon: <Ruler size={14} />, color: 'text-cyan-400', bg: 'bg-cyan-500/20', label: '–ë–µ–≥—É–Ω' },
            { id: 'gym', icon: <Dumbbell size={14} />, color: 'text-purple-400', bg: 'bg-purple-500/20', label: '–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä' },
            { id: 'reps', icon: <Activity size={14} />, color: 'text-emerald-400', bg: 'bg-emerald-500/20', label: '–ú–∞—à–∏–Ω–∞' },
            { id: 'early', icon: <Sun size={14} />, color: 'text-amber-400', bg: 'bg-amber-500/20', label: '–ñ–∞–≤–æ—Ä–æ–Ω–æ–∫' },
            { id: 'night', icon: <Moon size={14} />, color: 'text-indigo-400', bg: 'bg-indigo-500/20', label: '–°–æ–≤–∞' },
            { id: 'weekend', icon: <Calendar size={14} />, color: 'text-rose-400', bg: 'bg-rose-500/20', label: '–í—ã—Ö–æ–¥–Ω–æ–π' },
            { id: 'social', icon: <Send size={14} />, color: 'text-blue-400', bg: 'bg-blue-500/20', label: '–î—Ä—É–≥' },
            { id: 'redemption', icon: <Skull size={14} />, color: 'text-slate-400', bg: 'bg-slate-500/20', label: '–í—ã–∂–∏–≤—à–∏–π' },
        ];

        function App() {
            const [step, setStep] = useState('loading');
            const [user, setUser] = useState({ firstName: '', lastName: '', username: '', telegramId: null, photoUrl: null, disciplines: [], goal: 0, diamonds: 3, streak: 0, todayActivity: [], history: [], status: 'active', notifications: true, notificationTime: '09:00', isAdmin: false });
            const [marathonStartDate, setMarathonStartDate] = useState(DEFAULT_START_DATE);
            const [isSyncing, setIsSyncing] = useState(false);
            const [regForm, setRegForm] = useState({ firstName: '', lastName: '' });
            const [popularSports, setPopularSports] = useState(['–ë–µ–≥', '–ó–∞–ª', '–û—Ç–∂–∏–º–∞–Ω–∏—è', '–ü–ª–∞–≤–∞–Ω–∏–µ', '–í–æ—Ä–∫–∞—É—Ç', '–í–µ–ª–æ']);
            const [dashboardView, setDashboardView] = useState('leaderboard');
            const [isAddingCustom, setIsAddingCustom] = useState(false);
            const [customInput, setCustomInput] = useState("");
            const [checkInCustomInput, setCheckInCustomInput] = useState("");
            const [isAddingInCheckIn, setIsAddingInCheckIn] = useState(false);
            const [activeModal, setActiveModal] = useState(null);
            const [checkInStage, setCheckInStage] = useState('select');
            const [selectedSportForCheckIn, setSelectedSportForCheckIn] = useState(null);
            const [checkInValue, setCheckInValue] = useState("");
            const [adminDateInput, setAdminDateInput] = useState('');
            const [selectedDetailUser, setSelectedDetailUser] = useState(null);
            const [editUser, setEditUser] = useState(null);
            const [isAddingUser, setIsAddingUser] = useState(false);
            const [newUserNick, setNewUserNick] = useState("");
            const [leaderboard, setLeaderboard] = useState([
                { id: 1, name: 'Alex', photoUrl: null, diamonds: 3, streak: 12, goal: 100, status: 'active', disciplines: ['–ë–µ–≥', '–í–æ—Ä–∫–∞—É—Ç'], history: [], badges: ['streak', 'runner', 'early'] },
                { id: 2, name: 'Elena', photoUrl: null, diamonds: 5, streak: 45, goal: 60, status: 'active', disciplines: ['–ó–∞–ª', '–ü–ª–∞–≤–∞–Ω–∏–µ'], history: [], badges: ['gym'] },
            ]);

            useEffect(() => {
                const init = async () => {
                    const tg = window.Telegram?.WebApp;
                    if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#020617'); tg.setBackgroundColor('#020617'); }
                    if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.startsWith('http')) {
                        try { const res = await fetch(GOOGLE_SCRIPT_URL); const data = await res.json(); if (data.result === 'success' && data.config?.MARATHON_START_DATE) { setMarathonStartDate(new Date(data.config.MARATHON_START_DATE)); setAdminDateInput(data.config.MARATHON_START_DATE); } } catch (e) { console.error("Sync failed", e); }
                    }
                    const savedUser = localStorage.getItem('fitness_aurora_user');
                    const tgUser = tg?.initDataUnsafe?.user;
                    if (savedUser) { const parsed = JSON.parse(savedUser); if (tgUser) { parsed.photoUrl = tgUser.photo_url; parsed.isAdmin = (tgUser.username === ADMIN_USERNAME); } setUser(parsed); setStep('dashboard'); } 
                    else { if (tgUser) { setRegForm({ firstName: tgUser.first_name || '', lastName: tgUser.last_name || '' }); setUser(prev => ({ ...prev, telegramId: tgUser.id, username: tgUser.username, photoUrl: tgUser.photo_url, isAdmin: tgUser.username === ADMIN_USERNAME })); } setStep('welcome'); }
                };
                init();
            }, []);
            useEffect(() => { if (user.firstName) localStorage.setItem('fitness_aurora_user', JSON.stringify(user)); }, [user]);

            const getAdjustedGoals = () => { const now = new Date(); const diffDays = Math.ceil((now - marathonStartDate) / (1000 * 60 * 60 * 24)); const daysPassed = diffDays > 0 ? diffDays : 0; return [{ original: 30, remaining: 30 - daysPassed, label: '–ù–æ–≤–∏—á–æ–∫', icon: <Star size={24} className="text-emerald-400" /> }, { original: 60, remaining: 60 - daysPassed, label: '–ê—Ç–ª–µ—Ç', icon: <Dumbbell size={24} className="text-cyan-400" /> }, { original: 100, remaining: 100 - daysPassed, label: '–ö–∏–±–æ—Ä–≥', icon: <Crown size={24} className="text-amber-400" /> }].filter(g => g.remaining > 5); };
            const getStatsSummary = (history = []) => { let totalKm = 0, totalReps = 0; history.forEach(entry => { if (entry.unit === '–∫–º') totalKm += parseFloat(entry.value); if (entry.unit === '–ø–æ–≤—Ç') totalReps += parseInt(entry.value); }); return { totalKm, totalReps }; };
            const getUserTitle = (goal) => goal >= 100 ? '–ö–∏–±–æ—Ä–≥' : goal >= 60 ? '–ê—Ç–ª–µ—Ç' : '–ù–æ–≤–∏—á–æ–∫';
            const handleRegNext = () => { if (regForm.firstName) { setUser(p => ({ ...p, firstName: regForm.firstName, lastName: regForm.lastName })); setStep('arsenal'); } };
            const handleArsenalToggle = (sport) => setUser(prev => { const exists = prev.disciplines.includes(sport); if (exists) return { ...prev, disciplines: prev.disciplines.filter(d => d !== sport) }; if (prev.disciplines.length >= 5) return prev; return { ...prev, disciplines: [...prev.disciplines, sport] }; });
            const handleAddCustom = () => { if (customInput.trim()) { const s = customInput.trim(); setPopularSports(prev => [...prev, s]); handleArsenalToggle(s); setCustomInput(""); setIsAddingCustom(false); } };
            const handleGoalSelect = (goal) => { setUser(prev => ({ ...prev, goal })); setStep('dashboard'); };
            const handleCheckInComplete = (val, unit) => { const sport = selectedSportForCheckIn; setUser(prev => ({ ...prev, streak: prev.todayActivity.length === 0 ? prev.streak + 1 : prev.streak, todayActivity: [...prev.todayActivity, sport], history: [{ date: new Date().toISOString(), sport, value: val, unit }, ...prev.history] })); setActiveModal(null); setCheckInStage('select'); };
            const handleAddCustomFromCheckIn = () => { if (checkInCustomInput.trim()) { const newSport = checkInCustomInput.trim(); setPopularSports(prev => [...prev, newSport]); setUser(prev => { if (!prev.disciplines.includes(newSport)) return { ...prev, disciplines: [...prev.disciplines, newSport] }; return prev; }); setSelectedSportForCheckIn(newSport); setCheckInStage('value'); setCheckInCustomInput(""); setIsAddingInCheckIn(false); } };
            const handleSendMotivation = (e, name) => { e.stopPropagation(); alert(`–ú–æ—Ç–∏–≤–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ${name}! ‚ö°Ô∏è`); };
            const adminUpdateDate = async () => { if (!adminDateInput) return; setIsSyncing(true); try { setMarathonStartDate(new Date(adminDateInput)); if (GOOGLE_SCRIPT_URL) { await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'UPDATE_DATE', date: adminDateInput }) }); } alert("–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"); } catch (e) { alert("–û—à–∏–±–∫–∞: " + e.message); } finally { setIsSyncing(false); } };
            const adminAddUser = () => { if(!newUserNick) return; const newId = leaderboard.length + 1; const newUser = { id: newId, name: newUserNick, photoUrl: null, diamonds: 3, streak: 0, goal: 30, status: 'active', disciplines: ['–ë–µ–≥'], history: [], badges: [] }; setLeaderboard([...leaderboard, newUser]); setNewUserNick(""); setIsAddingUser(false); };
            const adminDeleteUser = (id) => { if(confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?")) setLeaderboard(leaderboard.filter(u => u.id !== id)); };
            const adminSaveUserChanges = () => { setLeaderboard(leaderboard.map(u => u.id === editUser.id ? editUser : u)); setEditUser(null); };
            const handleDeleteAccount = () => { if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.")) { localStorage.removeItem('fitness_aurora_user'); window.location.reload(); } };

            const RedemptionShop = () => {
                const [spinState, setSpinState] = useState('idle'); const [task, setTask] = useState(""); const tasks = ["–°–µ–ª—Ñ–∏ —Å –∫–æ—Ç–æ–º", "–ü–ª–∞–Ω–∫–∞ 1 –º–∏–Ω", "30 –ë–µ—Ä–ø–∏ –Ω–∞ –≤–∏–¥–µ–æ", "–°–º–µ—à–Ω–æ–µ –ª–∏—Ü–æ"];
                const spin = () => { setSpinState('spinning'); let counter = 0; const interval = setInterval(() => { setTask(tasks[counter % tasks.length]); counter++; }, 100); setTimeout(() => { clearInterval(interval); setTask(tasks[Math.floor(Math.random() * tasks.length)]); setSpinState('result'); }, 2000); };
                return (
                    <div className="fixed inset-0 z-50 bg-[#020617] screen-content animate-slide-up"><div className="flex items-center gap-3 mb-8"><button onClick={() => setActiveModal(null)} className="p-2 bg-white/10 rounded-full text-white"><ArrowLeft size={20}/></button><h2 className="text-2xl font-display font-bold text-rose-500 tracking-wider">–ú–ê–ì–ê–ó–ò–ù –ò–°–ö–£–ü–õ–ï–ù–ò–Ø</h2></div>
                        <GlassCard className="p-8 text-center border-rose-500/30 bg-rose-900/10 mb-6"><div className="inline-flex items-center justify-center w-20 h-20 bg-rose-500/20 rounded-full mb-4 animate-pulse"><Skull className="text-rose-500" size={40} /></div><h3 className="text-2xl font-black text-white uppercase mb-2">–ö–£–ü–ò–¢–¨ –ñ–ò–ó–ù–¨</h3><p className="text-rose-400 text-sm mb-6">–¶–µ–Ω–∞: –¢–≤–æ—è –≥–æ—Ä–¥–æ—Å—Ç—å</p>
                            {spinState === 'idle' && <NeonButton variant="danger" onClick={spin}>–ö–†–£–¢–ò–¢–¨ –†–£–õ–ï–¢–ö–£</NeonButton>}
                            {spinState === 'spinning' && <div className="text-xl font-bold text-white animate-pulse">{task}</div>}
                            {spinState === 'result' && (<div className="animate-fade-in"><div className="text-lg font-bold text-white mb-4 border p-4 rounded-xl border-dashed border-rose-500/50">{task}</div><NeonButton onClick={() => setSpinState('upload')} variant="danger"><Camera size={18}/> –ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</NeonButton></div>)}
                            {spinState === 'upload' && (<div className="animate-fade-in"><div className="w-full h-32 bg-slate-800 rounded-xl flex items-center justify-center mb-4 border border-dashed border-slate-600"><span className="text-slate-500 text-xs">–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</span></div><NeonButton onClick={() => { alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!"); setActiveModal(null); }} variant="gold">–û–¢–ü–†–ê–í–ò–¢–¨</NeonButton></div>)}
                        </GlassCard></div>
                );
            };

            const AdminPanel = () => (
                <div className="fixed inset-0 z-50 bg-[#020617] screen-content animate-fade-in"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-display font-bold text-amber-500 tracking-wider flex items-center gap-2"><Shield /> ADMIN</h2><button onClick={() => setActiveModal(null)} className="p-2 bg-white/10 rounded-full text-white"><X size={20}/></button></div>
                    {!editUser ? (
                        <div className="space-y-6"><GlassCard className="p-6"><h3 className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-4">–î–∞—Ç–∞ –°—Ç–∞—Ä—Ç–∞</h3><input type="date" value={adminDateInput} onChange={(e) => setAdminDateInput(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-cyan-500 mb-4" /><NeonButton variant="gold" onClick={adminUpdateDate} disabled={isSyncing}>{isSyncing ? "..." : "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"} <Save size={18} /></NeonButton></GlassCard>
                            {!isAddingUser ? (<NeonButton variant="secondary" onClick={() => setIsAddingUser(true)}><UserPlus size={18}/> –î–æ–±–∞–≤–∏—Ç—å –£—á–∞—Å—Ç–Ω–∏–∫–∞</NeonButton>) : (<GlassCard className="p-4 animate-fade-in"><input type="text" value={newUserNick} onChange={e => setNewUserNick(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded-xl p-3 text-white outline-none mb-3" placeholder="Nickname" /><div className="flex gap-2"><NeonButton variant="disabled" onClick={() => setIsAddingUser(false)}>–û—Ç–º–µ–Ω–∞</NeonButton><NeonButton onClick={adminAddUser}>–î–æ–±–∞–≤–∏—Ç—å</NeonButton></div></GlassCard>)}
                            <div className="space-y-2"><h3 className="text-slate-400 text-xs font-bold uppercase tracking-widest mb-2">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>{leaderboard.map(u => (<div key={u.id} className="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/10"><span className="text-white font-bold">{u.name}</span><div className="flex gap-2"><button onClick={() => setEditUser({...u})} className="p-2 bg-cyan-500/20 text-cyan-400 rounded-lg"><Edit3 size={16}/></button><button onClick={() => adminDeleteUser(u.id)} className="p-2 bg-rose-500/20 text-rose-400 rounded-lg"><Trash2 size={16}/></button></div></div>))}</div></div>
                    ) : (
                        <GlassCard className="p-6 animate-fade-in space-y-4"><h3 className="text-xl font-bold text-white mb-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {editUser.name}</h3><div><label className="text-xs text-slate-400">–ê–ª–º–∞–∑—ã</label><input type="number" value={editUser.diamonds} onChange={e => setEditUser({...editUser, diamonds: parseInt(e.target.value)})} className="w-full bg-slate-900 p-2 rounded text-white"/></div><div><label className="text-xs text-slate-400">–°—Ç—Ä–∏–∫</label><input type="number" value={editUser.streak} onChange={e => setEditUser({...editUser, streak: parseInt(e.target.value)})} className="w-full bg-slate-900 p-2 rounded text-white"/></div><div className="flex gap-2 pt-4"><NeonButton variant="disabled" onClick={() => setEditUser(null)}>–ù–∞–∑–∞–¥</NeonButton><NeonButton onClick={adminSaveUserChanges}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</NeonButton></div></GlassCard>)}
                </div>
            );

            const SettingsPanel = () => (
                <div className="fixed inset-0 z-50 bg-[#020617] screen-content animate-fade-in"><div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-display font-bold text-white tracking-wider">–ù–ê–°–¢–†–û–ô–ö–ò</h2><button onClick={() => setActiveModal(null)} className="p-2 bg-white/5 rounded-full shadow-sm border border-white/10 text-white"><X size={20} /></button></div><div className="space-y-6"><GlassCard className="p-4 flex flex-col gap-4"><div className="flex justify-between items-center"><div className="flex items-center gap-3"><div className="w-10 h-10 rounded-full bg-cyan-500/10 flex items-center justify-center text-cyan-400"><Bell size={20} /></div><div className="font-bold text-slate-200">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div></div><ToggleSwitch checked={user.notifications} onChange={(val) => setUser({...user, notifications: val})} /></div>{user.notifications && (<div className="flex items-center gap-3 mt-2 border-t border-white/10 pt-4"><Clock size={16} className="text-slate-400" /><input type="time" value={user.notificationTime} onChange={(e) => { setUser({...user, notificationTime: e.target.value}); }} className="bg-slate-900 text-white rounded p-2 text-sm border border-slate-700 outline-none" /><span className="text-xs text-slate-500">–í—Ä–µ–º—è</span></div>)}</GlassCard>
                        <div><label className="text-slate-500 text-xs font-bold uppercase tracking-widest mb-4 block px-1">–¢–≤–æ–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã ({user.disciplines.length}/5)</label><div className="flex flex-wrap gap-2 mb-4">{popularSports.map(s => (<button key={s} onClick={() => handleArsenalToggle(s)} className={`px-4 py-2 rounded-lg text-xs font-bold border transition-all ${user.disciplines.includes(s) ? 'bg-cyan-600/50 text-white border-cyan-500/50 shadow-sm' : 'bg-white/5 border-white/10 text-slate-400 hover:border-cyan-500/30 hover:text-cyan-400'}`}>{s}</button>))}</div>
                            {!isAddingCustom ? (<button onClick={() => setIsAddingCustom(true)} className="w-full p-3 border border-dashed border-slate-700 rounded-xl text-slate-500 text-xs font-bold uppercase tracking-widest hover:text-cyan-400 hover:border-cyan-500 transition-colors flex items-center justify-center gap-2"><Plus size={16}/> –°–≤–æ—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</button>) : (<div className="flex gap-2 animate-fade-in"><input type="text" value={customInput} onChange={e => setCustomInput(e.target.value)} className="flex-1 bg-slate-900 border border-cyan-500 rounded-xl px-4 text-white outline-none" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." autoFocus /><button onClick={handleAddCustom} className="p-3 bg-cyan-600 rounded-xl text-white"><CheckCircle size={20}/></button></div>)}
                        </div><button onClick={handleDeleteAccount} className="w-full py-4 text-xs font-bold text-rose-500 border border-rose-500/30 bg-rose-500/10 rounded-xl hover:bg-rose-500/20 transition-colors flex items-center justify-center gap-2 uppercase tracking-widest"><Trash2 size={16} /> –£–¥–∞–ª–∏—Ç—å –ê–∫–∫–∞—É–Ω—Ç</button></div></div>
            );
            
            const UserDetailModal = ({ detailUser, onClose }) => {
                if (!detailUser) return null;
                return (
                    <div className="fixed inset-0 z-50 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 animate-fade-in"><div className="w-full max-w-sm bg-[#0f172a] border border-white/10 rounded-3xl p-6 relative"><button onClick={onClose} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={24}/></button>
                            <div className="flex flex-col items-center mb-6"><Avatar name={detailUser.name} photoUrl={detailUser.photoUrl} size="w-20 h-20" className="mb-4" /><h3 className="text-2xl font-display font-bold text-white">{detailUser.name}</h3><div className="flex gap-2 mt-2"><span className="px-2 py-1 bg-white/5 rounded text-[10px] text-slate-300 border border-white/10">Streak: {detailUser.streak} üî•</span><span className="px-2 py-1 bg-white/5 rounded text-[10px] text-slate-300 border border-white/10">üíé {detailUser.diamonds}</span></div></div>
                            <h4 className="text-xs font-bold text-slate-500 uppercase tracking-widest mb-2">–î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</h4><div className="flex flex-wrap gap-2 mb-6">{detailUser.disciplines.map(d => <span key={d} className="px-2 py-1 bg-cyan-500/10 text-cyan-400 rounded-lg text-xs font-bold border border-cyan-500/20">{d}</span>)}</div>
                            <NeonButton variant="secondary" onClick={onClose}>–ó–∞–∫—Ä—ã—Ç—å</NeonButton></div></div>
                );
            };

            if (step === 'welcome') return (<div className="screen-content relative z-10 flex flex-col"><div className="flex-grow flex flex-col items-center justify-center text-center"><div className="relative w-40 h-40 flex items-center justify-center mb-8"><div className="absolute inset-0 bg-cyan-500 blur-[60px] opacity-30 rounded-full animate-pulse"></div><Hexagon size={130} className="text-cyan-400 stroke-[1.5] animate-float" /><Activity size={50} className="text-white absolute" /></div><h1 className="text-4xl font-black text-white font-display uppercase">Fitness<br/>Aurora</h1></div><NeonButton onClick={() => setStep('registration')}>–ù–∞—á–∞—Ç—å</NeonButton></div>);
            if (step === 'registration') return (<div className="screen-content relative z-10 flex flex-col animate-slide-up"><h2 className="text-2xl font-display font-bold text-white mb-6">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø</h2><div className="space-y-4 flex-grow"><input type="text" placeholder="–ò–º—è" value={regForm.firstName} onChange={e => setRegForm({...regForm, firstName: e.target.value})} className="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:border-cyan-500 placeholder:text-slate-500 font-bold" /><input type="text" placeholder="–§–∞–º–∏–ª–∏—è" value={regForm.lastName} onChange={e => setRegForm({...regForm, lastName: e.target.value})} className="w-full p-4 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:border-cyan-500 placeholder:text-slate-500 font-bold" /></div><NeonButton onClick={handleRegNext} disabled={!regForm.firstName}>–î–∞–ª–µ–µ</NeonButton></div>);
            if (step === 'arsenal') return (<div className="screen-content relative z-10 flex flex-col animate-slide-up"><h2 className="text-2xl font-display font-bold text-white mb-2">–ê–†–°–ï–ù–ê–õ</h2><p className="text-slate-400 text-xs mb-4">–í—ã–±–µ—Ä–∏ –¥–æ 5 –¥–∏—Å—Ü–∏–ø–ª–∏–Ω ({user.disciplines.length}/5)</p><div className="flex flex-wrap gap-3 mb-4">{popularSports.map(s => (<button key={s} onClick={() => handleArsenalToggle(s)} className={`px-4 py-3 rounded-xl text-sm font-bold border transition-all ${user.disciplines.includes(s) ? 'bg-cyan-600/80 text-white border-cyan-400' : 'bg-white/5 text-slate-400 border-white/10'}`}>{s}</button>))}</div>{!isAddingCustom ? (<button onClick={() => setIsAddingCustom(true)} className="w-full p-3 border border-dashed border-slate-600 rounded-xl text-slate-400 flex items-center justify-center gap-2 hover:border-cyan-500 hover:text-cyan-400 transition-colors"><Plus size={16}/> –°–≤–æ—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</button>) : (<div className="flex gap-2 animate-fade-in mb-4"><input type="text" value={customInput} onChange={e => setCustomInput(e.target.value)} className="flex-1 bg-slate-900 border border-cyan-500 rounded-xl px-4 text-white outline-none" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." autoFocus /><button onClick={handleAddCustom} className="p-3 bg-cyan-600 rounded-xl text-white"><CheckCircle size={20}/></button></div>)}<p className="text-slate-600 text-[10px] mt-4 text-center">–í—ã —Å–º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –ø–æ–∑–∂–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</p><div className="mt-auto"><NeonButton onClick={() => setStep('goal')} disabled={user.disciplines.length === 0}>–î–∞–ª–µ–µ</NeonButton></div></div>);
            if (step === 'goal') { const goals = getAdjustedGoals(); return (<div className="screen-content relative z-10 flex flex-col animate-slide-up"><h2 className="text-2xl font-display font-bold text-white mb-6 text-center">–í–´–ë–ï–†–ò –¶–ï–õ–¨</h2><div className="space-y-4 flex-grow">{goals.map((g, idx) => (<GlassCard key={idx} onClick={() => handleGoalSelect(g.remaining)} className="p-6 flex items-center justify-between group hover:bg-white/10 transition-colors"><div><span className="text-3xl font-display font-black text-white">{g.remaining} <span className="text-sm font-sans font-normal text-slate-400">–î–Ω–µ–π</span></span><div className="text-[10px] text-cyan-400 font-bold uppercase mt-1">–†–∞–Ω–≥: {g.label}</div></div><div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center text-white border border-white/10">{g.icon}</div></GlassCard>))}</div></div>); }

            const progressPercent = Math.min((user.streak / (user.goal || 1)) * 100, 100);
            const userStats = getStatsSummary(user.history);

            return (
                <div className="relative h-full">
                    <div className="fixed-header"><div className="flex justify-between items-center mb-2"><h1 className="text-lg font-display font-bold text-white tracking-widest">–ü–†–û–§–ò–õ–¨</h1><div className="flex gap-2">{user.isAdmin && <button onClick={() => setActiveModal('admin')} className="w-10 h-10 flex items-center justify-center rounded-lg bg-amber-500/20 text-amber-500 border border-amber-500/30"><Shield size={18} /></button>}<div onClick={() => setActiveModal('shop')} className="bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 flex items-center gap-2 cursor-pointer active:scale-95 transition-transform"><Diamond size={16} className="text-cyan-400 fill-cyan-400" /><span className="font-bold text-white">{user.diamonds}</span></div><button onClick={() => setActiveModal('settings')} className="w-10 h-10 flex items-center justify-center rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 text-slate-400 transition-colors"><Settings size={18} /></button></div></div><div className="flex justify-between items-start mb-2"><div className="flex items-center gap-3"><Avatar name={user.firstName} photoUrl={user.photoUrl} /><div><div className="font-display font-bold text-white leading-tight">{user.firstName}</div><div className="text-[10px] text-slate-400 font-bold uppercase mt-0.5">–°—Ç–∞—Ç—É—Å: <span className="text-emerald-400">–í —Å—Ç—Ä–æ—é</span></div></div></div></div><div className="flex justify-between text-[10px] font-bold text-slate-500 mb-1 uppercase tracking-widest"><span>{user.streak} Days</span><span>Goal: {user.goal}</span></div><div className="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden relative"><div className="bg-gradient-to-r from-cyan-500 to-purple-500 h-full shadow-[0_0_10px_rgba(34,211,238,0.5)]" style={{ width: `${progressPercent}%` }}></div></div></div>
                    <div className="screen-content space-y-6">
                        {user.todayActivity.length > 0 ? (<GlassCard className="p-8 text-center bg-emerald-900/10 border-emerald-500/20"><div className="inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-500/10 mb-4 text-emerald-400 border border-emerald-500/20 shadow-[0_0_20px_rgba(52,211,153,0.2)]"><CheckCircle size={32} /></div><h3 className="text-xl font-display font-bold text-white mb-2 tracking-wide">–î–ï–ù–¨ –ó–ê–°–ß–ò–¢–ê–ù</h3><div className="flex flex-wrap justify-center gap-2 mt-2 mb-6">{user.todayActivity.map((act, i) => (<span key={i} className="px-3 py-1 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-[10px] font-bold text-emerald-400 uppercase tracking-wider shadow-sm">{act}</span>))}</div><NeonButton variant="secondary" onClick={() => setActiveModal('checkIn')} className="py-3 text-xs"><Plus size={14} /> –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ</NeonButton></GlassCard>) : (<button onClick={() => setActiveModal('checkIn')} className="w-full aspect-[2.5/1] rounded-2xl glass-panel relative group overflow-hidden active:scale-[0.98] transition-all"><div className="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-purple-500/10 opacity-50"></div><div className="relative z-10 flex flex-col items-center justify-center h-full gap-2"><Zap size={28} className="text-cyan-400 fill-cyan-400 mb-1" /><span className="text-xl font-display font-black text-white uppercase tracking-widest">–û–¢–ú–ï–¢–ò–¢–¨–°–Ø</span></div></button>)}
                        <div className="flex justify-between items-center bg-white/5 p-1 rounded-xl border border-white/10"><button onClick={() => setDashboardView('leaderboard')} className={`flex-1 py-2.5 rounded-lg text-xs font-bold uppercase tracking-widest flex items-center justify-center gap-2 transition-all ${dashboardView === 'leaderboard' ? 'bg-slate-700 text-white shadow-sm' : 'text-slate-500'}`}><Users size={14}/> –†–µ–π—Ç–∏–Ω–≥</button><button onClick={() => setDashboardView('progress')} className={`flex-1 py-2.5 rounded-lg text-xs font-bold uppercase tracking-widest flex items-center justify-center gap-2 transition-all ${dashboardView === 'progress' ? 'bg-slate-700 text-white shadow-sm' : 'text-slate-500'}`}><BarChart3 size={14}/> –ü—Ä–æ–≥—Ä–µ—Å—Å</button></div>
                        {dashboardView === 'leaderboard' ? (
                            <div className="space-y-3">{leaderboard.map((u, idx) => (<GlassCard key={u.id} onClick={() => { setSelectedDetailUser(u); setActiveModal('userDetail'); }} className="p-4 flex items-center justify-between hover:bg-white/5 transition-colors"><div className="flex items-center gap-4"><div className="relative"><Avatar name={u.name} photoUrl={u.photoUrl} /><div className="absolute -top-1 -right-1 bg-slate-900 rounded-full w-4 h-4 flex items-center justify-center text-[9px] font-bold border border-slate-700 text-white">{idx + 1}</div></div><div><div className="font-bold text-slate-200">{u.name}</div><div className="flex gap-1 mt-1">{u.badges?.slice(0, 3).map((b, i) => (<div key={i} className="w-2 h-2 rounded-full bg-cyan-500 shadow-sm"></div>))}</div></div></div><div className="flex items-center gap-3"><div className="text-right"><div className="font-bold text-white text-sm">{u.streak} <span className="text-[10px] text-orange-400">üî•</span></div></div><button onClick={(e) => handleSendMotivation(e, u.name)} className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-cyan-400 hover:bg-cyan-400 hover:text-white transition-colors"><Zap size={14}/></button></div></GlassCard>))}</div>
                        ) : (
                            <div className="animate-fade-in space-y-6"><GlassCard className="p-6"><div className="flex items-center justify-between mb-6"><div className="flex items-center gap-3"><Avatar name={user.firstName} photoUrl={user.photoUrl} size="w-12 h-12" /><div><div className="text-[9px] text-slate-500 font-bold uppercase tracking-widest">–†–∞–Ω–≥</div><div className="font-display font-black text-lg text-white tracking-wide">{getUserTitle(user.goal)}</div></div></div><div className="text-right"><div className="text-[9px] text-slate-500 font-bold uppercase tracking-widest">–¶–µ–ª—å</div><div className="font-display font-black text-xl text-cyan-400">{user.goal} <span className="text-sm text-slate-500 font-sans font-normal">–î–Ω–µ–π</span></div></div></div><div className="grid grid-cols-2 gap-3"><div className="bg-slate-800/50 p-3 rounded-xl border border-white/5 text-center"><Ruler size={16} className="mx-auto text-cyan-500 mb-1" /><div className="font-display font-bold text-lg text-slate-200">{userStats.totalKm}</div><div className="text-[9px] text-slate-500 uppercase font-bold">–ö–ú –í—Å–µ–≥–æ</div></div><div className="bg-slate-800/50 p-3 rounded-xl border border-white/5 text-center"><Dumbbell size={16} className="mx-auto text-purple-500 mb-1" /><div className="font-display font-bold text-lg text-slate-200">{userStats.totalReps}</div><div className="text-[9px] text-slate-500 uppercase font-bold">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π</div></div></div></GlassCard>
                                <div><h3 className="text-slate-500 uppercase text-[10px] font-bold tracking-[0.2em] mb-3">–ù–∞–≥—Ä–∞–¥—ã</h3><div className="grid gap-2 grid-cols-3">{badgesData.map(b => (<div key={b.id} className="flex flex-col items-center p-3 rounded-xl border border-white/5 bg-white/5 text-center opacity-50 grayscale hover:opacity-100 hover:grayscale-0 transition-all"><div className={`w-8 h-8 rounded-full flex items-center justify-center mb-2 border ${b.bg} ${b.color}`}>{b.icon}</div><div className="font-bold text-slate-400 text-[9px] uppercase">{b.label}</div></div>))}</div></div>
                                <div><h3 className="text-slate-500 uppercase text-[10px] font-bold tracking-[0.2em] mb-3">–ò—Å—Ç–æ—Ä–∏—è</h3><div className="space-y-2">{user.history.map((item, i) => (<div key={i} className="flex justify-between items-center p-3 bg-white/5 rounded-xl border border-white/5"><div className="flex items-center gap-2"><div className="w-1 h-8 bg-cyan-500 rounded-full"></div><div><div className="text-sm font-bold text-white">{item.sport}</div><div className="text-[10px] text-slate-500">{new Date(item.date).toLocaleDateString()}</div></div></div><div className="text-white font-bold">{item.value} <span className="text-[10px] text-slate-500">{item.unit}</span></div></div>))}</div></div></div>
                        )}
                    </div>

                    {activeModal === 'shop' && <RedemptionShop />}
                    {activeModal === 'admin' && <AdminPanel />}
                    {activeModal === 'settings' && <SettingsPanel />}
                    {activeModal === 'userDetail' && selectedDetailUser && <UserDetailModal detailUser={selectedDetailUser} onClose={() => setActiveModal(null)} />}
                    {activeModal === 'checkIn' && (
                        <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-end sm:items-center justify-center p-4 animate-fade-in"><div className="w-full max-w-md bg-[#0f172a] border border-white/10 rounded-t-3xl p-6 sm:rounded-3xl">
                                {checkInStage === 'select' ? (
                                    <>
                                        <div className="flex justify-between items-center mb-6"><h3 className="text-lg font-bold text-white">–ß–¢–û –°–î–ï–õ–ê–ù–û?</h3><button onClick={() => setActiveModal(null)}><X className="text-slate-500" /></button></div>
                                        <div className="space-y-3 mb-4">{user.disciplines.map(s => (<button key={s} onClick={() => { setSelectedSportForCheckIn(s); setCheckInStage('value'); }} className="w-full p-4 bg-white/5 rounded-xl text-left font-bold text-slate-300 hover:bg-cyan-500/10 hover:text-cyan-400 transition-colors flex justify-between">{s} <ChevronDown size={16} className="-rotate-90 text-slate-600" /></button>))}</div>
                                        {!isAddingInCheckIn ? (<button onClick={() => setIsAddingInCheckIn(true)} className="w-full p-4 border border-dashed border-slate-700 rounded-xl text-slate-500 font-bold hover:text-cyan-400 hover:border-cyan-500 transition-colors flex items-center justify-center gap-2"><Plus size={16}/> –°–≤–æ—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</button>) : (<div className="flex gap-2 animate-fade-in"><input type="text" value={checkInCustomInput} onChange={e => setCheckInCustomInput(e.target.value)} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." className="flex-1 p-4 bg-slate-900 border border-cyan-500 rounded-xl text-white outline-none" autoFocus /><button onClick={handleAddCustomFromCheckIn} className="p-4 bg-cyan-600 rounded-xl text-white shadow-lg"><CheckCircle size={20}/></button></div>)}
                                    </>
                                ) : (
                                    <div className="text-center"><h3 className="text-lg font-bold text-white mb-6">{selectedSportForCheckIn}</h3><div className="flex items-end justify-center gap-2 mb-8"><input type="number" autoFocus onChange={e => setCheckInValue(e.target.value)} className="bg-transparent border-b-2 border-slate-700 text-center text-5xl font-black text-white w-32 outline-none focus:border-cyan-500" placeholder="0" /><span className="text-slate-500 font-bold mb-2">–ï–î.</span></div><div className="flex gap-3"><NeonButton variant="disabled" onClick={() => setCheckInStage('select')}>–ù–∞–∑–∞–¥</NeonButton><NeonButton onClick={() => handleCheckInComplete(checkInValue, 'units')} disabled={!checkInValue}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</NeonButton></div></div>
                                )}</div></div>
                    )}
                </div>
            );
        }
        const root = createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>
