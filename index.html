<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fitness Aurora Final</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script><script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={theme:{extend:{colors:{aurora:{bg:'#020617'}},fontFamily:{sans:['Inter','sans-serif'],display:['Space Grotesk','sans-serif']},animation:{'aurora':'aurora 20s ease infinite alternate','fade-in':'fadeIn 0.3s ease-out forwards','pulse-slow':'pulse 3s infinite'},keyframes:{aurora:{'0%':{backgroundPosition:'0% 50%'},'100%':{backgroundPosition:'100% 50%'}},fadeIn:{'0%':{opacity:'0',transform:'translateY(10px)'},'100%':{opacity:'1',transform:'translateY(0)'}}}}}}
</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@babel/standalone@7.26.9/babel.min.js"></script>
<style>
html,body{margin:0;padding:0;background-color:#020617;color:#f1f5f9;width:100%;height:100%;overflow:hidden;overscroll-behavior:none;-webkit-tap-highlight-color:transparent}
#root{height:100%;width:100%;overflow-y:auto;-webkit-overflow-scrolling:touch;position:relative;z-index:10;display:flex;flex-direction:column;padding-bottom:40px}
.aurora-bg{background:linear-gradient(-45deg,#020617,#1e1b4b,#111827,#0f172a);background-size:400% 400%;position:fixed;inset:0;z-index:0;animation:aurora 15s ease infinite alternate}
.glass{background:rgba(30,41,59,0.6);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,0.08);box-shadow:0 8px 32px rgba(0,0,0,0.2)}
.modal-full{position:fixed;inset:0;z-index:100;background-color:#020617;display:flex;flex-direction:column;overflow-y:auto}
.modal-head{position:sticky;top:0;background:rgba(2,6,23,0.95);backdrop-filter:blur(10px);z-index:50;padding:20px 1.5rem 10px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:10px}
</style>
</head>
<body>
<div class="aurora-bg"></div><div id="root"></div>
<script type="text/babel" data-type="module">
import React,{useState,useEffect}from'https://esm.sh/react@18.2.0';import{createRoot}from'https://esm.sh/react-dom@18.2.0/client';
import{Trophy,Diamond,Zap,Camera,CheckCircle,Activity,Settings,Plus,X,Hexagon,Flame,Send,Bell,Skull,Dumbbell,Ruler,Star,Crown,BarChart3,Users,Calendar,ChevronDown,Shield,Edit3,Save,Trash2,ArrowLeft,Clock,UserPlus,Sun,Moon}from'https://esm.sh/lucide-react@0.263.1';

const GOOGLE_SCRIPT_URL='–í–°–¢–ê–í–¨–¢–ï_–í–ê–®–£_–°–°–´–õ–ö–£_–°–Æ–î–ê';
const ADMIN_USERNAME='solomin_d';
const DEFAULT_START_DATE=new Date('2026-04-01');

// UI Components
const GlassCard=({children,className="",onClick})=>(<div onClick={onClick} className={`relative glass rounded-3xl overflow-hidden ${onClick?'cursor-pointer active:scale-95 transition-transform':''} ${className}`}>{children}</div>);
const NeonButton=({children,onClick,variant='primary',disabled=false,className=""})=>{
    const v={primary:"bg-cyan-600 text-white shadow-lg border-cyan-400/30",danger:"bg-rose-600 text-white border-rose-400/30",gold:"bg-amber-500 text-white border-amber-300/30",secondary:"bg-white/10 text-white hover:bg-white/20",disabled:"bg-slate-800 text-slate-500 cursor-not-allowed"};
    return(<button onClick={onClick} disabled={disabled} className={`w-full py-4 font-bold tracking-wider uppercase rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-2 text-sm ${disabled?v.disabled:v[variant]} ${className}`}>{children}</button>);
};
const Avatar=({name,photoUrl,size="w-16 h-16"})=>{
    if(photoUrl)return<img src={photoUrl} alt={name} className={`${size} rounded-full object-cover border-2 border-white/20 shadow-md`}/>;
    return<div className={`${size} rounded-full bg-gradient-to-br from-cyan-600 to-blue-700 flex items-center justify-center text-white font-bold border-2 border-white/20 text-xl shadow-md`}>{name?name.slice(0,2).toUpperCase():"FQ"}</div>;
};
const ToggleSwitch=({checked,onChange})=>(<button onClick={()=>onChange(!checked)} className={`w-12 h-7 rounded-full p-1 transition-colors ${checked?'bg-cyan-500':'bg-slate-700'}`}><div className={`w-5 h-5 rounded-full bg-white transition-transform ${checked?'translate-x-5':'translate-x-0'}`}/></button>);

const badgesData=[{id:'streak',icon:<Flame size={14}/>,color:'text-orange-400',bg:'bg-orange-500/20',label:'–ù–∞ –æ–≥–Ω–µ',desc:'–°—Ç—Ä–∏–∫ 3+ –¥–Ω–µ–π'},{id:'runner',icon:<Ruler size={14}/>,color:'text-cyan-400',bg:'bg-cyan-500/20',label:'–ë–µ–≥—É–Ω',desc:'10+ –∫–º'},{id:'gym',icon:<Dumbbell size={14}/>,color:'text-purple-400',bg:'bg-purple-500/20',label:'–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä',desc:'5+ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –∑–∞–ª–µ'},{id:'reps',icon:<Activity size={14}/>,color:'text-emerald-400',bg:'bg-emerald-500/20',label:'–ú–∞—à–∏–Ω–∞',desc:'500+ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π'},{id:'early',icon:<Sun size={14}/>,color:'text-amber-400',bg:'bg-amber-500/20',label:'–ñ–∞–≤–æ—Ä–æ–Ω–æ–∫',desc:'–î–æ 8:00 —É—Ç—Ä–∞'},{id:'night',icon:<Moon size={14}/>,color:'text-indigo-400',bg:'bg-indigo-500/20',label:'–°–æ–≤–∞',desc:'–ü–æ—Å–ª–µ 22:00'},{id:'weekend',icon:<Calendar size={14}/>,color:'text-rose-400',bg:'bg-rose-500/20',label:'–í—ã—Ö–æ–¥–Ω–æ–π',desc:'–°–±/–í—Å'},{id:'social',icon:<Send size={14}/>,color:'text-blue-400',bg:'bg-blue-500/20',label:'–î—Ä—É–≥',desc:'–ü—Ä–∏–≥–ª–∞—Å–∏–ª –¥—Ä—É–≥–∞'},{id:'redemption',icon:<Skull size={14}/>,color:'text-slate-400',bg:'bg-slate-500/20',label:'–í—ã–∂–∏–≤—à–∏–π',desc:'–ö—É–ø–∏–ª –∂–∏–∑–Ω—å'}];

function App(){
    const[step,setStep]=useState('loading');
    const[user,setUser]=useState({firstName:'',lastName:'',username:'',photoUrl:null,disciplines:[],goal:0,diamonds:3,streak:0,todayActivity:[],history:[],status:'active',notifications:true,notificationTime:'09:00',isAdmin:false,lastCheckInDate:null});
    const[startDate,setStartDate]=useState(DEFAULT_START_DATE);
    const[regForm,setRegForm]=useState({firstName:'',lastName:''});
    const[sports,setSports]=useState(['–ë–µ–≥','–ó–∞–ª','–û—Ç–∂–∏–º–∞–Ω–∏—è','–ü–ª–∞–≤–∞–Ω–∏–µ','–í–æ—Ä–∫–∞—É—Ç','–í–µ–ª–æ']);
    const[view,setView]=useState('leaderboard');
    const[modal,setModal]=useState(null);
    const[expandedId,setExpandedId]=useState(null);
    const[badgeInfo,setBadgeInfo]=useState(null);
    const[customInput,setCustomInput]=useState("");
    const[isAddingCustom,setIsAddingCustom]=useState(false);
    const[checkInInput,setCheckInInput]=useState("");
    const[isAddingCheckIn,setIsAddingCheckIn]=useState(false);
    const[checkStage,setCheckStage]=useState('select');
    const[selectedSport,setSelectedSport]=useState(null);
    const[checkValue,setCheckValue]=useState("");
    const[adminDate,setAdminDate]=useState('');
    const[editUser,setEditUser]=useState(null);
    const[isAddingUser,setIsAddingUser]=useState(false);
    const[newUserNick,setNewUserNick]=useState("");
    const[isSyncing,setIsSyncing]=useState(false);
    const[leaderboard,setLeaderboard]=useState([{id:1,name:'Alex',diamonds:3,streak:12,goal:100,disciplines:['–ë–µ–≥'],history:[],badges:['streak']},{id:2,name:'Elena',diamonds:5,streak:45,goal:60,disciplines:['–ó–∞–ª'],history:[],badges:['gym']}]);

    useEffect(()=>{
        const tg=window.Telegram?.WebApp; if(tg){tg.ready();tg.expand();tg.setHeaderColor('#020617');tg.setBackgroundColor('#020617');tg.enableClosingConfirmation();}
        const saved=localStorage.getItem('fitness_aurora_user');
        if(saved){const p=JSON.parse(saved); if(tg?.initDataUnsafe?.user){p.photoUrl=tg.initDataUnsafe.user.photo_url;p.isAdmin=(tg.initDataUnsafe.user.username===ADMIN_USERNAME);} setUser(p);setStep('dashboard');}
        else{if(tg?.initDataUnsafe?.user){setRegForm({firstName:tg.initDataUnsafe.user.first_name||'',lastName:tg.initDataUnsafe.user.last_name||''});setUser(p=>({...p,telegramId:tg.initDataUnsafe.user.id,username:tg.initDataUnsafe.user.username,photoUrl:tg.initDataUnsafe.user.photo_url,isAdmin:tg.initDataUnsafe.user.username===ADMIN_USERNAME}));}setStep('welcome');}
        if(GOOGLE_SCRIPT_URL.startsWith('http')){fetch(GOOGLE_SCRIPT_URL).then(r=>r.json()).then(d=>{if(d.result==='success'&&d.config?.MARATHON_START_DATE){setStartDate(new Date(d.config.MARATHON_START_DATE));setAdminDate(d.config.MARATHON_START_DATE);}});}
    },[]);
    useEffect(()=>{if(user.firstName)localStorage.setItem('fitness_aurora_user',JSON.stringify(user));},[user]);

    const getGoals=()=>{const d=Math.max(0,Math.ceil((new Date()-startDate)/86400000));return[{o:30,r:Math.max(0,30-d),l:'–ù–æ–≤–∏—á–æ–∫',i:<Star size={24} className="text-emerald-400"/>},{o:60,r:Math.max(0,60-d),l:'–ê—Ç–ª–µ—Ç',i:<Dumbbell size={24} className="text-cyan-400"/>},{o:100,r:Math.max(0,100-d),l:'–ö–∏–±–æ—Ä–≥',i:<Crown size={24} className="text-amber-400"/>}];};
    const getStats=(h=[])=>{let k=0,r=0;h.forEach(x=>{if(x.unit==='–∫–º')k+=+x.value;if(x.unit==='–ø–æ–≤—Ç')r+=+x.value;});return{k,r};};
    const toggleSport=(s)=>setUser(p=>({...p,disciplines:p.disciplines.includes(s)?p.disciplines.filter(d=>d!==s):[...p.disciplines,s]}));
    const completeCheckIn=(val,unit)=>{
        const today=new Date().toDateString(); const isNew=user.lastCheckInDate!==today;
        setUser(p=>({...p,streak:isNew?p.streak+1:p.streak,lastCheckInDate:today,todayActivity:[...p.todayActivity,selectedSport],history:[{date:new Date().toISOString(),sport:selectedSport,value:val,unit},...p.history]}));
        setModal(null);setCheckStage('select');
    };
    const addCustom=(name,isChk=false)=>{if(!name.trim())return;setSports(p=>[...p,name]);setUser(p=>({...p,disciplines:[...p.disciplines,name]}));if(isChk){setSelectedSport(name);setCheckStage('value');}setIsAddingCustom(false);setIsAddingCheckIn(false);setCustomInput("");setCheckInInput("");};
    const updateDate=async()=>{if(!adminDate)return;setIsSyncing(true);try{setStartDate(new Date(adminDate));if(GOOGLE_SCRIPT_URL)await fetch(GOOGLE_SCRIPT_URL,{method:'POST',body:JSON.stringify({action:'UPDATE_DATE',date:adminDate})});alert("–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");}catch(e){}finally{setIsSyncing(false);}};
    const ShopLogic=({onClose})=>{
        const[s,setS]=useState('idle');const[t,setT]=useState("");const tasks=["–°–µ–ª—Ñ–∏ —Å –∫–æ—Ç–æ–º","–ü–ª–∞–Ω–∫–∞ 1 –º–∏–Ω","30 –ë–µ—Ä–ø–∏","–°–º–µ—à–Ω–æ–µ –ª–∏—Ü–æ"];
        const spin=()=>{setS('spinning');let c=0;const i=setInterval(()=>{setT(tasks[c%4]);c++},100);setTimeout(()=>{clearInterval(i);setT(tasks[Math.floor(Math.random()*4)]);setS('result');},2000);};
        return(<GlassCard className="p-6 text-center w-full"><Skull className="mx-auto text-rose-500 mb-4" size={48}/><h3 className="text-2xl font-black text-white uppercase mb-2">–ò–°–ö–£–ü–õ–ï–ù–ò–ï</h3><p className="text-rose-400 text-sm mb-6">–¶–µ–Ω–∞: –¢–≤–æ—è –≥–æ—Ä–¥–æ—Å—Ç—å</p>{s==='idle'&&<NeonButton variant="danger" onClick={spin}>–ö–†–£–¢–ò–¢–¨</NeonButton>}{s==='spinning'&&<div className="text-xl font-bold text-white animate-pulse">{t}</div>}{s==='result'&&(<div className="animate-fade-in"><div className="text-xl font-bold text-white mb-6 border p-4 rounded-xl border-dashed border-rose-500/50">{t}</div><NeonButton onClick={()=>setS('upload')} variant="danger"><Camera size={18}/> –§–û–¢–û</NeonButton></div>)}{s==='upload'&&(<div className="animate-fade-in"><div className="w-full h-32 bg-slate-800 rounded-xl flex items-center justify-center mb-4 border-dashed border-2 border-slate-600 text-slate-500 text-xs">–§–û–¢–û</div><NeonButton onClick={()=>{alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!");onClose();}} variant="gold">–û–¢–ü–†–ê–í–ò–¢–¨</NeonButton></div>)}</GlassCard>);
    };

    if(step==='welcome')return(<div className="h-full flex flex-col items-center justify-center p-6 pt-20"><div className="relative w-48 h-48 flex items-center justify-center mb-8"><div className="absolute inset-0 bg-cyan-500 blur-[80px] opacity-40 rounded-full animate-pulse"></div><Hexagon size={140} className="text-cyan-400 stroke-[1.5] animate-float"/><Activity size={60} className="text-white absolute"/></div><h1 className="text-5xl font-black text-white mb-2 text-center tracking-tighter">FITNESS<br/><span className="text-cyan-400">AURORA</span></h1><div className="mt-auto w-full max-w-xs pb-10"><NeonButton onClick={()=>setStep('registration')}>–ù–ê–ß–ê–¢–¨</NeonButton></div></div>);
    if(step==='registration')return(<div className="p-6 pt-20 flex flex-col h-full overflow-y-auto"><h2 className="text-3xl font-black text-white mb-8">–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø</h2><div className="space-y-4 flex-grow"><input placeholder="–ò–º—è" value={regForm.firstName} onChange={e=>setRegForm({...regForm,firstName:e.target.value})} className="w-full p-5 bg-white/5 rounded-2xl text-white border border-white/10 outline-none font-bold"/><input placeholder="–§–∞–º–∏–ª–∏—è" value={regForm.lastName} onChange={e=>setRegForm({...regForm,lastName:e.target.value})} className="w-full p-5 bg-white/5 rounded-2xl text-white border border-white/10 outline-none font-bold"/></div><div className="pb-10"><NeonButton onClick={()=>{setUser(p=>({...p,...regForm}));setStep('arsenal');}} disabled={!regForm.firstName}>–î–ê–õ–ï–ï</NeonButton></div></div>);
    if(step==='arsenal')return(<div className="p-6 pt-20 flex flex-col h-full overflow-y-auto"><div className="flex justify-between items-center mb-2"><h2 className="text-3xl font-black text-white">–ê–†–°–ï–ù–ê–õ</h2><span className="text-sm font-mono text-cyan-400">{user.disciplines.length}</span></div><div className="flex flex-wrap gap-3 mb-6">{sports.map(s=>(<button key={s} onClick={()=>toggleSport(s)} className={`px-5 py-3 rounded-xl text-sm font-bold border transition-all ${user.disciplines.includes(s)?'bg-cyan-600/20 text-cyan-400 border-cyan-500':'bg-white/5 text-slate-400 border-white/10'}`}>{s}</button>))}</div>{!isAddingCustom?<button onClick={()=>setIsAddingCustom(true)} className="w-full p-4 border border-dashed border-slate-600 rounded-xl text-slate-400 flex items-center justify-center gap-2 hover:border-cyan-500 hover:text-cyan-400 text-sm"><Plus size={18}/> –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é</button>:<div className="flex gap-2 mb-4"><input value={customInput} onChange={e=>setCustomInput(e.target.value)} className="flex-1 bg-slate-900 border border-cyan-500 rounded-xl px-4 text-white outline-none" autoFocus placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..."/><button onClick={()=>addCustom(customInput)} className="p-3 bg-cyan-600 rounded-xl text-white"><CheckCircle/></button></div>}<div className="mt-auto pb-10"><NeonButton onClick={()=>setStep('goal')} disabled={user.disciplines.length===0}>–î–ê–õ–ï–ï</NeonButton></div></div>);
    if(step==='goal')return(<div className="p-6 pt-20 flex flex-col h-full overflow-y-auto"><h2 className="text-3xl font-black text-white mb-8 text-center">–¢–í–û–Ø –¶–ï–õ–¨</h2><div className="space-y-4 flex-grow">{getGoals().map((g,i)=>(<GlassCard key={i} onClick={()=>{setUser(p=>({...p,goal:g.o}));setStep('dashboard');}} className="p-6 flex items-center justify-between group hover:border-cyan-500/50"><div><span className="text-4xl font-black text-white">{g.r} <span className="text-sm font-medium text-slate-400">–î–Ω–µ–π</span></span><div className="text-xs text-cyan-400 uppercase mt-1 font-bold">{g.l}</div></div><div className="w-14 h-14 rounded-full bg-white/5 flex items-center justify-center border border-white/10">{g.i}</div></GlassCard>))}</div></div>);

    const progress=Math.min((user.streak/user.goal)*100,100);
    return(
        <div className="flex flex-col min-h-full p-5 pt-20 space-y-6 pb-24">
            <GlassCard className="p-5">
                <div className="flex justify-between items-start mb-5"><div className="flex items-center gap-4"><Avatar name={user.firstName} photoUrl={user.photoUrl}/><div className="leading-tight"><h1 className="text-2xl font-black text-white">{user.firstName}</h1><div className="text-xs font-bold uppercase mt-1 text-emerald-400"><span className="text-slate-500">–°—Ç–∞—Ç—É—Å: </span>–í —Å—Ç—Ä–æ—é</div></div></div><div className="flex gap-2">{user.isAdmin&&<button onClick={()=>setModal('admin')} className="w-10 h-10 flex items-center justify-center rounded-xl bg-amber-500/10 text-amber-500 border border-amber-500/30"><Shield size={18}/></button>}<button onClick={()=>setModal('shop')} className="w-10 h-10 flex items-center justify-center rounded-xl bg-cyan-500/10 text-cyan-400 border border-cyan-500/30"><Diamond size={18}/></button><button onClick={()=>setModal('settings')} className="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-slate-400"><Settings size={18}/></button></div></div>
                <div className="space-y-2"><div className="flex justify-between text-[10px] font-bold text-slate-400 uppercase"><span>{user.streak} Days Streak</span><span>Goal: {user.goal}</span></div><div className="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden relative"><div className="bg-gradient-to-r from-cyan-500 to-purple-500 h-full shadow-[0_0_15px_rgba(6,182,212,0.5)]" style={{width:`${progress}%`}}></div></div></div>
            </GlassCard>
            {user.todayActivity.length>0?(<GlassCard className="p-6 text-center bg-emerald-900/10 border-emerald-500/30"><div className="inline-flex items-center justify-center w-14 h-14 rounded-full bg-emerald-500/10 mb-4 text-emerald-400"><CheckCircle size={28}/></div><h3 className="text-xl font-black text-white mb-4">–î–ï–ù–¨ –ó–ê–°–ß–ò–¢–ê–ù</h3><div className="flex flex-wrap justify-center gap-2 mb-6">{user.todayActivity.map((a,i)=>(<span key={i} className="px-4 py-1.5 bg-emerald-500/5 border border-emerald-500/20 rounded-lg text-xs font-bold text-emerald-300 uppercase">{a}</span>))}</div><button onClick={()=>setModal('checkIn')} className="w-full py-4 bg-white/5 border border-white/10 rounded-xl text-white font-bold hover:bg-white/10 flex items-center justify-center gap-2 text-xs uppercase tracking-widest"><Plus size={14}/> –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ</button></GlassCard>):(<button onClick={()=>setModal('checkIn')} className="w-full h-48 rounded-3xl glass flex flex-col items-center justify-center gap-4 active:scale-95 transition-all"><div className="p-6 bg-cyan-500/10 rounded-full text-cyan-400 animate-pulse-slow"><Zap size={48} fill="currentColor"/></div><span className="text-3xl font-black text-white uppercase tracking-widest">–û–¢–ú–ï–¢–ò–¢–¨–°–Ø</span></button>)}
            <div className="flex justify-between items-center border-b border-white/10 pb-2"><h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest">{view==='leaderboard'?'–£–ß–ê–°–¢–ù–ò–ö–ò':'–ú–û–ô –ü–†–û–ì–†–ï–°–°'}</h3><div className="flex gap-2"><button onClick={()=>setView('leaderboard')} className={`p-2 rounded-lg ${view==='leaderboard'?'text-cyan-400 bg-cyan-900/20':'text-slate-600'}`}><Users size={20}/></button><button onClick={()=>setView('progress')} className={`p-2 rounded-lg ${view==='progress'?'text-cyan-400 bg-cyan-900/20':'text-slate-600'}`}><BarChart3 size={20}/></button></div></div>
            {view==='leaderboard'?<div className="space-y-3 pb-10">{leaderboard.map((u,i)=>(<GlassCard key={u.id} onClick={()=>setExpandedId(expandedId===u.id?null:u.id)} className="p-5 transition-all"><div className="flex items-center justify-between"><div className="flex items-center gap-4"><div className="relative"><Avatar name={u.name} size="w-10 h-10"/><div className="absolute -top-1 -right-1 bg-slate-900 rounded-full w-5 h-5 flex items-center justify-center text-[10px] font-bold border border-slate-700 text-white">{i+1}</div></div><div><div className="font-bold text-slate-200 text-lg">{u.name}</div><div className="flex gap-1 mt-1.5">{u.badges?.slice(0,4).map(bid=>{const b=badgesData.find(x=>x.id===bid);return b?<div key={bid} className={`w-4 h-4 rounded-full flex items-center justify-center border ${b.bg} ${b.color}`}>{React.cloneElement(b.icon,{size:10})}</div>:null})}</div></div></div><div className="flex items-center gap-4"><div className="text-right"><div className="font-black text-white text-lg">{u.streak} <span className="text-xs text-orange-400">üî•</span></div></div><button onClick={(e)=>{e.stopPropagation();alert("–ú–æ—Ç–∏–≤–∞—Ü–∏—è!");}} className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-cyan-400"><Zap size={18}/></button></div></div>{expandedId===u.id&&(<div className="mt-5 pt-5 border-t border-white/5 animate-expand overflow-hidden"><div className="grid grid-cols-2 gap-3 mb-4"><div className="bg-white/5 p-3 rounded-xl text-center"><span className="text-[10px] uppercase text-slate-500 block mb-1">–ê–ª–º–∞–∑—ã</span><span className="font-bold text-white text-lg">{u.diamonds} üíé</span></div><div className="bg-white/5 p-3 rounded-xl text-center"><span className="text-[10px] uppercase text-slate-500 block mb-1">–¶–µ–ª—å</span><span className="font-bold text-white text-lg">{u.goal} –¥–Ω.</span></div></div><div className="flex flex-wrap gap-2">{u.disciplines?.map(d=><span key={d} className="text-xs px-3 py-1.5 bg-white/5 rounded-lg border border-white/10 text-slate-300 font-bold">{d}</span>)}</div></div>)}</GlassCard>))}</div>
            :<div className="space-y-6 pb-10"><GlassCard className="p-6 grid grid-cols-2 gap-4"><div className="text-center"><Ruler className="mx-auto text-cyan-400 mb-2"/><div className="text-2xl font-black text-white">{getStats(user.history).k}</div><div className="text-[10px] text-slate-500 uppercase font-bold">–ö–ú –í—Å–µ–≥–æ</div></div><div className="text-center"><Dumbbell className="mx-auto text-purple-400 mb-2"/><div className="text-2xl font-black text-white">{getStats(user.history).r}</div><div className="text-[10px] text-slate-500 uppercase font-bold">–ü–æ–≤—Ç–æ—Ä–æ–≤</div></div></GlassCard><div><h3 className="text-slate-500 uppercase text-[10px] font-bold tracking-widest mb-4">–ê—á–∏–≤–∫–∏</h3><div className="grid gap-3 grid-cols-3">{badgesData.map(b=>(<div key={b.id} onClick={()=>setBadgeInfo(b)} className="flex flex-col items-center p-4 rounded-2xl border border-white/5 bg-white/5 text-center opacity-70 hover:opacity-100 transition-all cursor-pointer"><div className={`w-10 h-10 rounded-full flex items-center justify-center mb-3 border ${b.bg} ${b.color}`}>{b.icon}</div><div className="font-bold text-slate-300 text-[9px] uppercase">{b.label}</div></div>))}</div></div><div><h3 className="text-slate-500 uppercase text-[10px] font-bold tracking-widest mb-4">–ò—Å—Ç–æ—Ä–∏—è</h3><div className="space-y-3">{user.history.map((h,i)=>(<div key={i} className="flex justify-between p-4 bg-white/5 rounded-xl border border-white/5"><div className="flex items-center gap-3"><div className="w-1 h-8 bg-cyan-500 rounded-full"></div><div><div className="font-bold text-white">{h.sport}</div><div className="text-[10px] text-slate-500">{new Date(h.date).toLocaleDateString()}</div></div></div><div className="text-white font-bold text-lg">{h.value} <span className="text-xs text-slate-500 font-medium">{h.unit}</span></div></div>))}</div></div></div>}
            
            {modal==='settings'&&<div className="modal-full animate-fade-in"><div className="modal-head"><button onClick={()=>setModal(null)} className="p-2 bg-white/10 rounded-full text-white"><ArrowLeft size={24}/></button><h2 className="text-xl font-bold text-white">–ù–ê–°–¢–†–û–ô–ö–ò</h2></div><div className="p-6 space-y-8 flex-1"><GlassCard className="p-5 space-y-5"><div className="flex justify-between items-center"><div className="flex items-center gap-3"><Bell className="text-cyan-400"/><span className="font-bold text-white">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span></div><ToggleSwitch checked={user.notifications} onChange={v=>setUser({...user,notifications:v})}/></div>{user.notifications&&<div className="flex items-center gap-3 border-t border-white/10 pt-4"><Clock className="text-slate-400"/><input type="time" value={user.notificationTime} onChange={e=>setUser({...user,notificationTime:e.target.value})} className="bg-slate-900 text-white rounded p-2 text-sm outline-none"/><span className="text-xs text-slate-500">–í—Ä–µ–º—è</span></div>}</GlassCard><div><label className="text-slate-500 text-xs font-bold uppercase mb-4 block px-1">–ê—Ä—Å–µ–Ω–∞–ª</label><div className="flex flex-wrap gap-2 mb-4">{sports.map(s=>(<button key={s} onClick={()=>toggleSport(s)} className={`px-4 py-2 rounded-lg text-xs font-bold border ${user.disciplines.includes(s)?'bg-cyan-600/50 text-white border-cyan-500':'bg-white/5 text-slate-400 border-white/10'}`}>{s}</button>))}</div>{!isAddingCustom?<button onClick={()=>setIsAddingCustom(true)} className="w-full p-4 border border-dashed border-slate-700 rounded-xl text-slate-500 text-sm font-bold uppercase hover:text-cyan-400 flex items-center justify-center gap-2"><Plus size={18}/> –î–æ–±–∞–≤–∏—Ç—å</button>:<div className="flex gap-2"><input value={customInput} onChange={e=>setCustomInput(e.target.value)} className="flex-1 bg-slate-900 border border-cyan-500 rounded-xl px-4 text-white outline-none" autoFocus placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"/><button onClick={()=>addCustom(customInput)} className="p-3 bg-cyan-600 rounded-xl text-white"><CheckCircle size={20}/></button></div>}</div><button onClick={()=>{if(confirm("–£–¥–∞–ª–∏—Ç—å?")){localStorage.removeItem('fitness_aurora_user');window.location.reload();}}} className="w-full py-4 text-xs font-bold text-rose-500 border border-rose-500/30 bg-rose-500/10 rounded-xl uppercase flex items-center justify-center gap-2"><Trash2 size={16}/> –£–¥–∞–ª–∏—Ç—å –ê–∫–∫–∞—É–Ω—Ç</button><NeonButton onClick={()=>setModal(null)} className="mt-8">–°–û–•–†–ê–ù–ò–¢–¨</NeonButton></div></div>}
            {modal==='admin'&&<div className="modal-full animate-fade-in"><div className="modal-head"><button onClick={()=>setModal(null)} className="p-2 bg-white/10 rounded-full text-white"><ArrowLeft size={20}/></button><h2 className="text-xl font-bold text-amber-500">ADMIN</h2></div><div className="p-6 space-y-6 flex-1"><GlassCard className="p-5"><div className="text-xs text-slate-500 uppercase mb-2">–î–∞—Ç–∞ –°—Ç–∞—Ä—Ç–∞</div><div className="flex gap-2 items-center"><input type="date" value={adminDate} onChange={e=>setAdminDate(e.target.value)} className="bg-slate-900 border border-slate-700 rounded p-3 text-white text-sm flex-1"/><button onClick={updateDate} className="p-3 bg-amber-500 rounded text-black"><Save size={20}/></button></div></GlassCard>{!editUser?(<div className="space-y-3">{!isAddingUser?<NeonButton variant="secondary" onClick={()=>setIsAddingUser(true)}>+ –£—á–∞—Å—Ç–Ω–∏–∫</NeonButton>:<GlassCard className="p-4 mb-4"><input value={newUserNick} onChange={e=>setNewUserNick(e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded p-3 text-white mb-3" placeholder="Nick"/><div className="flex gap-2"><NeonButton onClick={()=>setIsAddingUser(false)} variant="disabled">–û—Ç–º</NeonButton><NeonButton onClick={()=>{if(newUserNick){setLeaderboard([...leaderboard,{id:Date.now(),name:newUserNick,diamonds:3,streak:0,goal:30,disciplines:[],history:[]}]);setNewUserNick("");setIsAddingUser(false);}}}>OK</NeonButton></div></GlassCard>}{leaderboard.map(u=><div key={u.id} className="flex justify-between items-center p-4 bg-white/5 rounded-xl border border-white/10"><span className="text-white font-bold">{u.name}</span><div className="flex gap-2"><button onClick={()=>setEditUser({...u})} className="p-2 bg-cyan-500/20 text-cyan-400 rounded-lg"><Edit3 size={18}/></button><button onClick={()=>{if(confirm('Del?'))setLeaderboard(l=>l.filter(x=>x.id!==u.id))}} className="p-2 bg-rose-500/20 text-rose-400 rounded-lg"><Trash2 size={18}/></button></div></div>)}</div>):(<GlassCard className="p-5 space-y-4"><h3 className="text-white font-bold text-xl">Edit {editUser.name}</h3><input type="number" value={editUser.diamonds} onChange={e=>setEditUser({...editUser,diamonds:+e.target.value})} className="w-full bg-slate-900 p-3 text-white rounded-lg"/><input type="number" value={editUser.streak} onChange={e=>setEditUser({...editUser,streak:+e.target.value})} className="w-full bg-slate-900 p-3 text-white rounded-lg"/><div className="flex gap-2"><NeonButton onClick={()=>setEditUser(null)} variant="disabled">Back</NeonButton><NeonButton onClick={()=>{setLeaderboard(l=>l.map(x=>x.id===editUser.id?editUser:x));setEditUser(null);}}>Save</NeonButton></div></GlassCard>)}</div></div>}
            {modal==='shop'&&<div className="modal-full animate-slide-up"><div className="modal-head"><button onClick={()=>setModal(null)} className="p-2 bg-white/10 rounded-full text-white"><ArrowLeft size={20}/></button><h2 className="text-xl font-bold text-rose-500">–ú–ê–ì–ê–ó–ò–ù</h2></div><div className="flex-1 flex items-center justify-center p-6"><ShopLogic onClose={()=>setModal(null)}/></div></div>}
            {modal==='checkIn'&&<div className="fixed inset-0 z-[70] bg-black/80 backdrop-blur-md flex items-end sm:items-center justify-center p-4 animate-fade-in"><div className="w-full max-w-md bg-[#0f172a] border border-white/10 rounded-t-3xl p-6 sm:rounded-3xl">{checkStage==='select'&&(<> <div className="flex justify-between mb-6"><h3 className="text-lg font-bold text-white">–ß–¢–û –°–î–ï–õ–ê–ù–û?</h3><button onClick={()=>setModal(null)}><X className="text-slate-500"/></button></div><div className="space-y-3 mb-6 max-h-60 overflow-y-auto">{user.disciplines.map(s=>(<button key={s} onClick={()=>{setSelectedSport(s);if(s.toLowerCase().includes('–∑–∞–ª')||s.toLowerCase().includes('gym'))setCheckStage('gym');else setCheckStage('value');}} className="w-full p-5 bg-white/5 rounded-2xl text-left font-bold text-slate-300 hover:bg-cyan-500/10 flex justify-between">{s} <ChevronDown size={20}/></button>))}</div>{!isAddingCheckIn?<button onClick={()=>setIsAddingCheckIn(true)} className="w-full p-4 border border-dashed border-slate-700 rounded-xl text-slate-500 font-bold hover:text-cyan-400 flex items-center justify-center gap-2"><Plus size={18}/> –°–≤–æ—è</button>:<div className="flex gap-2"><input value={checkInInput} onChange={e=>setCheckInInput(e.target.value)} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." className="flex-1 p-4 bg-slate-900 border border-cyan-500 rounded-xl text-white outline-none" autoFocus/><button onClick={()=>addCustom(checkInInput,true)} className="p-4 bg-cyan-600 rounded-xl text-white"><CheckCircle size={24}/></button></div>}</>)}{checkStage==='gym'&&(<div className="text-center mt-4"><h3 className="text-xl font-bold text-white mb-8">–ß–¢–û –ö–ê–ß–ê–õ?</h3><div className="grid grid-cols-2 gap-4 mb-8">{['–í—Å—ë —Ç–µ–ª–æ','–í–µ—Ä—Ö','–ù–∏–∑','–ì–æ–ª–æ–≤–æ–π'].map(o=>(<button key={o} onClick={()=>{setCheckValue(o);completeCheckIn(o,'—Ç–∏–ø');}} className="p-5 bg-white/5 border border-white/10 rounded-2xl text-slate-200 font-bold hover:bg-cyan-600 transition-colors">{o}</button>))}</div><NeonButton variant="disabled" onClick={()=>setCheckStage('select')}>–ù–∞–∑–∞–¥</NeonButton></div>)}{checkStage==='value'&&(<div className="text-center mt-4"><h3 className="text-xl font-bold text-white mb-8">{selectedSport}</h3><div className="flex items-end justify-center gap-2 mb-10"><input type="number" autoFocus onChange={e=>setCheckValue(e.target.value)} className="bg-transparent border-b-2 border-slate-700 text-center text-6xl font-black text-white w-40 outline-none focus:border-cyan-500" placeholder="0"/><span className="text-slate-500 font-bold mb-2 text-xl">–ï–î.</span></div><div className="flex gap-3"><NeonButton variant="disabled" onClick={()=>setCheckStage('select')}>–ù–∞–∑–∞–¥</NeonButton><NeonButton onClick={()=>completeCheckIn(checkValue,'units')} disabled={!checkValue}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</NeonButton></div></div>)}</div></div>}
            {badgeInfo&&<div className="fixed inset-0 z-[80] bg-black/80 backdrop-blur-md flex items-center justify-center p-6 animate-fade-in" onClick={()=>setBadgeInfo(null)}><div className="bg-[#0f172a] border border-white/10 rounded-3xl p-8 text-center max-w-sm w-full" onClick={e=>e.stopPropagation()}><div className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 border ${badgeInfo.bg} ${badgeInfo.color}`}>{React.cloneElement(badgeInfo.icon,{size:40})}</div><h3 className="text-2xl font-black text-white mb-2">{badgeInfo.label}</h3><p className="text-slate-400 mb-8">{badgeInfo.desc}</p><NeonButton variant="secondary" onClick={()=>setBadgeInfo(null)}>–ü–û–ù–Ø–¢–ù–û</NeonButton></div></div>}
        </div>
    );
}
const root=createRoot(document.getElementById('root'));root.render(<App/>);
</script>
</body>
</html>
